(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))m(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const y of u.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&m(y)}).observe(document,{childList:!0,subtree:!0});function a(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function m(o){if(o.ep)return;o.ep=!0;const u=a(o);fetch(o.href,u)}})();const A=Object.freeze([["pyramid","drink","worm"],["pyramid","kill","worm"],["pyramid","stop","savathun"],["pyramid","give","darkness"],["guardian","worship","light"],["guardian","worship","traveller"],["guardian","kill","witness"],["traveller","give","guardian"],["traveller","give","light"],["hive","worship","darkness"],["hive","worship","worm"],["darkness","stop","savathun"]]),$=Object.freeze([["hive","kill","worm"],["hive","kill","light"],["hive","give","darkness"],["hive","stop","witness"],["traveller","kill","guardian"],["traveller","drink","worm"],["traveller","give","hive"],["traveller","stop","witness"],["pyramid","drink","guardian"],["pyramid","stop","witness"],["witness","drink","light"],["witness","kill","pyramid"],["guardian","worship","witness"],["guardian","kill","traveller"],["savathun","drink","darkness"],["savathun","stop","darkness"],["light","stop","savathun"]]);let q=null,R=null;const Z=(i,s)=>i.length===s.length&&i.every((a,m)=>a===s[m]),he=i=>A.some(s=>Z(s,i))?"truth":$.some(s=>Z(s,i))?"lie":null,ee=i=>[1,2,3].map(s=>document.querySelector(`.dial-slot.${i}${s}`)?.dataset.symbol||null),T=(i,s)=>i.filter(a=>a.every((m,o)=>!s[o]||s[o]===m)),ge=(i,s)=>{const a=new Set(i);return!s.some(m=>a.has(m))};function j(i){return q?q===i?R==="truth"?[A]:[$]:R==="truth"?[$]:[A]:[A,$]}function te(i,s){const a=[...new Set(j("left").flatMap(o=>T(o,i).map(u=>u.join("|"))))].map(o=>o.split("|")),m=[...new Set(j("right").flatMap(o=>T(o,s).map(u=>u.join("|"))))].map(o=>o.split("|"));if(!a.length||!m.length)return!1;for(const o of a)for(const u of m)if(ge(o,u))return!0;return!1}function ye(i,s,a){if(a<0||a>2)return[];const m=s==="left"?[...i]:ee("left"),o=s==="right"?[...i]:ee("right"),u=T(j(s).flat(),s==="left"?m:o),y=[...new Set(u.map(p=>p[a]))],b=new Set(i.filter(Boolean)),h=[];for(const p of y)if(!b.has(p))if(s==="left"){const v=[...m];v[a]=p,te(v,o)&&h.push(p)}else{const v=[...o];v[a]=p,te(m,v)&&h.push(p)}return h}function P(i){return he(i)}function oe(i,s){q=i,R=s}function ne(){q=null,R=null}const we={stop:{top:"22.31%",left:"38.64%"},kill:{top:"70.14%",left:"65.96%"},darkness:{top:"39.91%",left:"80.93%"},drink:{top:"1.74%",left:"56.29%"},give:{top:"22.31%",left:"53.32%"},guardian:{top:"45.96%",left:"19.49%"},hive:{top:"29.77%",left:"19.53%"},light:{top:"59.68%",left:"72.98%"},pyramid:{top:"62.75%",left:"2.15%"},savathun:{top:"5.32%",left:"92.50%"},traveller:{top:"87.52%",left:"19.53%"},witness:{top:"30.20%",left:"2.00%"},worm:{top:"7.16%",left:"75.20%"},worship:{top:"70.42%",left:"31.45%"}},O={defaultDesktop:"below",defaultMobile:"below",desktopAbove:["hive","drink","witness","pyramid","worm"],mobileAbove:["hive","drink","witness","pyramid","worm"]};function le(){return window.matchMedia("(max-width: 640px)").matches}function z(){const i=new Set(le()?O.mobileAbove:O.desktopAbove),s=(le()?O.defaultMobile:O.defaultDesktop)==="above";document.querySelectorAll(".symbol-wrap").forEach(a=>{const m=a.dataset.symbol,o=i.has(m)||s;a.classList.toggle("label-above",o),a.classList.toggle("label-below",!o)})}function be(i=[],s=[]){const a=document.getElementById("map-overlay");if(!a)return;a.innerHTML="";const m=(o,u)=>{const y=we[o];if(!y)return;const b=document.createElement("div");b.className=`symbol-wrap ${u}`,b.dataset.symbol=o,b.style.top=y.top,b.style.left=y.left;const h=document.createElement("img");h.className="symbol-overlay",h.src=`img/${o}.png`,h.alt=o,b.appendChild(h);const p=document.createElement("div");p.className="map-label",p.textContent=o.toUpperCase(),b.appendChild(p),a.appendChild(b)};i.forEach(o=>m(o,"truth")),s.forEach(o=>m(o,"lie")),z()}window.addEventListener("resize",z);window.addEventListener("orientationchange",z);window.showMapHighlights=be;window.addEventListener("DOMContentLoaded",()=>{const i=()=>{const e=document.querySelector(".dial");if(!e)return;const t=e.getBoundingClientRect().width,n=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--truthlie-coef"))||.085,l=Math.max(10,Math.round(t*n))+"px",r=document.getElementById("label-left"),c=document.getElementById("label-right");r&&r.style.setProperty("font-size",l,"important"),c&&c.style.setProperty("font-size",l,"important")};requestAnimationFrame(i),window.addEventListener("resize",i);const s=document.querySelectorAll(".dial-slot"),a=document.getElementById("symbolPopup"),m=document.getElementById("popupGrid"),o=document.getElementById("lockButton"),u=document.querySelector(".btn-reset"),y=document.getElementById("tooltip"),b=document.getElementById("tooltipCheckbox"),h=document.getElementById("symbolNamesCheckbox");let p="entry",v=[],x=[],B=[];localStorage.getItem("firstVisitDone")!=="true"&&(localStorage.setItem("tooltipVisible","true"),localStorage.setItem("showSymbolNames","true"),localStorage.setItem("firstVisitDone","true"));const D=(localStorage.getItem("tooltipVisible")??"true")==="true";b.checked=D,y.classList.toggle("hidden",!D),b.addEventListener("change",()=>{const e=b.checked;y.classList.toggle("hidden",!e),localStorage.setItem("tooltipVisible",e?"true":"false")});const k=e=>{y&&(y.textContent=e)},U=(localStorage.getItem("showSymbolNames")??"true")==="true";h.checked=U;function M(e){document.querySelectorAll(".dial-slot .symbol-name, .map-label").forEach(t=>{t.style.display=e?"block":"none"})}M(U),h.addEventListener("change",()=>{const e=h.checked;localStorage.setItem("showSymbolNames",e?"true":"false"),M(e)});const _=e=>[1,2,3].map(t=>document.querySelector(`.dial-slot.${e}${t}`)),E=e=>_(e).map(t=>t?.dataset.symbol||null),ie=()=>E("left").every(Boolean)&&E("right").every(Boolean);function se(e){const t=(e.dataset.symbol||"").toUpperCase();let n=e.querySelector(".symbol-name");n||(n=document.createElement("div"),n.className="symbol-name",e.appendChild(n)),n.textContent=t,n.style.display=h.checked?"block":"none"}const V=(e,t)=>{e.dataset.symbol=t||"",e.style.backgroundImage=t?`url('img/${t}.png')`:"",se(e)};function G(e,t,n){const l=[...new Set(ye(e,t,n))],r=new Set(e.filter(Boolean));return l.filter(c=>!r.has(c))}function ae(e,t){const n=E(e);return n[t]=null,G(n,e,t)}function W(e,t){const n=E(e);return G(n,e,t)}const Y=()=>{if(p!=="entry")return;const e=E("left"),t=E("right"),n=e.every(Boolean),l=t.every(Boolean);if(n&&!l){const r=P(e);r&&(oe("left",r),K("left",r),k("Now complete the opposite side."))}else if(l&&!n){const r=P(t);r&&(oe("right",r),K("right",r),k("Now complete the opposite side."))}};function K(e,t){const n=document.getElementById("label-left"),l=document.getElementById("label-right"),r=(c,f)=>{c&&(c.textContent=f?f.toUpperCase():"",c.className=f==="truth"?"truth-label":f==="lie"?"lie-label":"")};e==="left"?(r(n,t),l&&r(l,"")):(r(l,t),n&&r(n,"")),i()}const re=()=>{if(p!=="entry")return;let e=!0;for(;e;)e=!1,["left","right"].forEach(t=>{_(t).forEach((n,l)=>{if(!n||n.dataset.symbol)return;const r=W(t,l);r.length===1&&(V(n,r[0]),e=!0,Y())})});H()},ce=window.MAP_COORDS||{},de=window.SYMBOL_NAME_MAP||{};window.showMapHighlights=(e,t,n=!0)=>{const l=document.getElementById("map-overlay");if(!l)return;l.innerHTML="",[...e.map(c=>({sym:c,type:"truth"})),...t.map(c=>({sym:c,type:"lie"}))].forEach(({sym:c,type:f})=>{const w=ce[c];if(!w)return;const d=document.createElement("div");d.className=`symbol-wrap ${f}`,d.style.left=`${w.x}%`,d.style.top=`${w.y}%`,d.style.transform="translate(-50%, -50%)";const g=document.createElement("img");g.className="symbol-overlay",g.src=`img/${c}.png`,g.alt=c,d.appendChild(g);const L=w.y>=88;d.classList.add(L?"label-above":"label-below");const S=document.createElement("div");S.className="map-label",S.textContent=n?de[c]||c.toUpperCase():"",d.appendChild(S),l.appendChild(d)}),M(h.checked)},[...s].forEach(e=>{e.addEventListener("click",()=>{if(p==="final")return;const t=Array.from(e.classList),n=t.find(d=>/^left[123]$/.test(d)),l=t.find(d=>/^right[123]$/.test(d)),r=n?"left":l?"right":null,c=n?+n.replace("left","")-1:l?+l.replace("right","")-1:null;if(!r||c==null)return;if(p==="illumination"){v.includes(e)&&e.classList.toggle("glow");return}const f=!!e.dataset.symbol;let w=f?ae(r,c):W(r,c);if(f&&w.length===0&&e.dataset.symbol&&(w=[e.dataset.symbol]),m.innerHTML="",f){const d=document.createElement("div");d.textContent="Clear",Object.assign(d.style,{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",background:"#333",border:"1px solid #777",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"700"}),d.addEventListener("click",()=>{V(e,""),a.style.display="none",ne(),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",k("Enter the symbols you see in-game"),i(),H()}),m.appendChild(d)}if(w.length===0){const d=document.createElement("div");d.textContent="No valid symbols",m.appendChild(d)}else w.forEach(d=>{const g=document.createElement("img");g.src=`img/${d}.png`,g.alt=d,g.addEventListener("click",()=>{V(e,d),a.style.display="none",Y(),H(),re()}),m.appendChild(g)});a.style.display="block"})}),document.addEventListener("click",e=>{!a.contains(e.target)&&![...s].includes(e.target)&&(a.style.display="none")});const C=document.createElement("div");C.id="rotatePrompt",C.className="rotate-prompt",C.textContent="Rotate device to view map",document.body.appendChild(C);function F(e){C.classList.toggle("show",!!e)}function I(){const e=document.querySelector(".map-container"),t=document.querySelector(".map-img"),n=document.getElementById("map-overlay");if(!e||!t||!n)return;const l=window.visualViewport,r=l?l.width:window.innerWidth,c=l?l.height:window.innerHeight,f=l?l.offsetLeft:0,w=l?l.offsetTop:0,d=t.naturalWidth&&t.naturalHeight?t.naturalWidth/t.naturalHeight:1920/1080;let g=r,L=g/d;L>c&&(L=c,g=L*d);const S=f+(r-g)/2,X=w+(c-L)/2;Object.assign(t.style,{width:`${g}px`,height:`${L}px`,left:`${S}px`,top:`${X}px`}),Object.assign(n.style,{width:`${g}px`,height:`${L}px`,left:`${S}px`,top:`${X}px`})}async function me(){try{document.documentElement.requestFullscreen&&!document.fullscreenElement&&await document.documentElement.requestFullscreen(),screen.orientation&&screen.orientation.lock&&await screen.orientation.lock("landscape")}catch{}}async function ue(){if(!(window.innerWidth<=900))return;document.body.classList.add("map-only");const t=document.querySelector(".map-img");t?t.complete?I():t.addEventListener("load",I,{once:!0}):I(),await me(),F(window.matchMedia("(orientation: portrait)").matches)}function pe(){document.body.classList.remove("map-only"),F(!1),document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen().catch(()=>{})}const N=()=>{document.body.classList.contains("map-only")&&I()};if(window.addEventListener("resize",N),window.addEventListener("orientationchange",()=>{N(),document.body.classList.contains("map-only")&&F(window.matchMedia("(orientation: portrait)").matches)}),window.visualViewport){const e=window.visualViewport;e.addEventListener("resize",N),e.addEventListener("scroll",N)}function fe(e,t){p="illumination",o.classList.add("glow-phase"),a.style.display="none",k("Now select the symbols that are illuminated in-game");const n=document.getElementById("label-left"),l=document.getElementById("label-right");n&&l&&(n.textContent=e.toUpperCase(),l.textContent=t.toUpperCase(),n.className=e==="truth"?"truth-label":"lie-label",l.className=t==="truth"?"truth-label":"lie-label",i());const r=E("left"),c=E("right");x=e==="truth"?r:c,B=e==="truth"?c:r,v=[],[...x,...B].forEach(f=>{const w=[...s].find(d=>d.dataset.symbol===f);w&&v.push(w)})}function J(){if(p!=="illumination")return;const e=[...document.querySelectorAll(".dial-slot.glow")].map(l=>l.dataset.symbol),t=x.filter(l=>e.includes(l)),n=B.filter(l=>!e.includes(l));o.classList.remove("glow-phase"),p="final",k("Follow the map to interact with the marked symbols. Tap Reset to start again."),window.showMapHighlights(t,n),ue()}function Q(){document.querySelectorAll(".dial-slot").forEach(t=>{t.dataset.symbol="",t.style.backgroundImage="",t.classList.remove("glow");const n=t.querySelector(".symbol-name");n&&(n.textContent="")}),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",o.classList.remove("glow-phase"),a.style.display="none",p="entry",v=[],x=[],B=[],ne(),k("Enter the symbols you see in-game");const e=document.getElementById("map-overlay");e&&(e.innerHTML=""),M(h.checked),pe(),i()}window.handleLock=J,window.resetDial=Q,o.addEventListener("click",J),u.addEventListener("click",Q);function H(){if(!ie())return;const e=E("left"),t=E("right"),n=P(e),l=P(t);!e.some(f=>t.includes(f))&&(n==="truth"&&l==="lie"||n==="lie"&&l==="truth")?fe(n,l):k("Both sides must be opposite types with no duplicate symbols across the dial.")}});
