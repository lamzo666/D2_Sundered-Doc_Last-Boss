(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&d(m)}).observe(document,{childList:!0,subtree:!0});function c(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(t){if(t.ep)return;t.ep=!0;const r=c(t);fetch(t.href,r)}})();const S=Object.freeze([["pyramid","drink","worm"],["pyramid","kill","worm"],["pyramid","stop","savathun"],["pyramid","give","darkness"],["guardian","worship","light"],["guardian","worship","traveller"],["guardian","kill","witness"],["traveller","give","guardian"],["traveller","give","light"],["hive","worship","darkness"],["hive","worship","worm"],["darkness","stop","savathun"]]),C=Object.freeze([["hive","kill","worm"],["hive","kill","light"],["hive","give","darkness"],["hive","stop","witness"],["traveller","kill","guardian"],["traveller","drink","worm"],["traveller","give","hive"],["traveller","stop","witness"],["pyramid","drink","guardian"],["pyramid","stop","witness"],["witness","drink","light"],["witness","kill","pyramid"],["guardian","worship","witness"],["guardian","kill","traveller"],["savathun","drink","darkness"],["savathun","stop","darkness"],["light","stop","savathun"]]);let I=null,B=null;const F=(s,l)=>s.length===l.length&&s.every((c,d)=>c===l[d]),Y=s=>S.some(l=>F(l,s))?"truth":C.some(l=>F(l,s))?"lie":null,z=s=>[1,2,3].map(l=>document.querySelector(`.dial-slot.${s}${l}`)?.dataset.symbol||null),x=(s,l)=>s.filter(c=>c.every((d,t)=>!l[t]||l[t]===d)),Z=(s,l)=>{const c=new Set(s);return!l.some(d=>c.has(d))};function O(s){return I?I===s?B==="truth"?[S]:[C]:B==="truth"?[C]:[S]:[S,C]}function W(s,l){const c=[...new Set(O("left").flatMap(t=>x(t,s).map(r=>r.join("|"))))].map(t=>t.split("|")),d=[...new Set(O("right").flatMap(t=>x(t,l).map(r=>r.join("|"))))].map(t=>t.split("|"));if(!c.length||!d.length)return!1;for(const t of c)for(const r of d)if(Z(t,r))return!0;return!1}function _(s,l,c){if(c<0||c>2)return[];const d=l==="left"?[...s]:z("left"),t=l==="right"?[...s]:z("right"),r=x(O(l).flat(),l==="left"?d:t),m=[...new Set(r.map(g=>g[c]))],h=new Set(s.filter(Boolean)),u=[];for(const g of m)if(!h.has(g))if(l==="left"){const y=[...d];y[c]=g,W(y,t)&&u.push(g)}else{const y=[...t];y[c]=g,W(d,y)&&u.push(g)}return u}function E(s){return Y(s)}function K(s,l){I=s,B=l}function ee(){I=null,B=null}const $={stop:{top:"22.31%",left:"38.64%"},kill:{top:"70.14%",left:"65.96%"},darkness:{top:"39.91%",left:"80.93%"},drink:{top:"1.74%",left:"56.29%"},give:{top:"22.31%",left:"53.32%"},guardian:{top:"45.96%",left:"19.49%"},hive:{top:"29.77%",left:"19.53%"},light:{top:"59.68%",left:"72.98%"},pyramid:{top:"62.75%",left:"2.15%"},savathun:{top:"5.32%",left:"92.50%"},traveller:{top:"87.52%",left:"19.53%"},witness:{top:"30.20%",left:"2.00%"},worm:{top:"7.16%",left:"75.20%"},worship:{top:"70.42%",left:"31.45%"}};function te(s,l){const c=document.getElementById("map-overlay");c.innerHTML="";const d=(t,r)=>{if(!$[t])return;const m=document.createElement("div");m.className=`symbol-wrap pulse ${r}`,m.style.top=$[t].top,m.style.left=$[t].left;const h=document.createElement("img");h.className="symbol-overlay",h.src=`img/${t}.png`,h.alt=t,m.appendChild(h);const u=document.createElement("div");u.className="map-label",u.textContent=t.toUpperCase(),m.appendChild(u),c.appendChild(m)};s.forEach(t=>d(t,"truth")),l.forEach(t=>d(t,"lie"))}window.showMapHighlights=te;window.addEventListener("DOMContentLoaded",()=>{const s=document.querySelectorAll(".dial-slot"),l=document.getElementById("symbolPopup"),c=document.getElementById("popupGrid"),d=document.getElementById("lockButton"),t=document.querySelector(".btn-reset"),r=document.getElementById("tooltip"),m=document.getElementById("tooltipCheckbox"),h=document.getElementById("symbolNamesCheckbox");let u="entry",g=[],y=[],L=[];localStorage.getItem("firstVisitDone")!=="true"&&(localStorage.setItem("tooltipVisible","true"),localStorage.setItem("showSymbolNames","true"),localStorage.setItem("firstVisitDone","true"));const V=localStorage.getItem("tooltipVisible")!=="false";m.checked=V,r.classList.toggle("hidden",!V),m.addEventListener("change",()=>{const e=m.checked;r.classList.toggle("hidden",!e),localStorage.setItem("tooltipVisible",e?"true":"false")});const v=e=>{r&&(r.textContent=e)},R=localStorage.getItem("showSymbolNames"),j=R===null?!0:R==="true";h.checked=j;function N(e){document.querySelectorAll(".dial-slot .symbol-name, .map-label").forEach(n=>{n.style.display=e?"block":"none"})}N(j),h.addEventListener("change",()=>{const e=h.checked;localStorage.setItem("showSymbolNames",e?"true":"false"),N(e)});const w=e=>[document.querySelector(`.dial-slot.${e}1`)?.dataset.symbol||null,document.querySelector(`.dial-slot.${e}2`)?.dataset.symbol||null,document.querySelector(`.dial-slot.${e}3`)?.dataset.symbol||null],J=()=>w("left").every(Boolean)&&w("right").every(Boolean);function Q(e){const n=(e.dataset.symbol||"").toUpperCase();let o=e.querySelector(".symbol-name");o||(o=document.createElement("div"),o.className="symbol-name",e.appendChild(o)),o.textContent=n,o.style.display=h.checked?"block":"none"}const P=()=>{if(u!=="entry")return;const e=w("left"),n=w("right"),o=e.every(Boolean),i=n.every(Boolean);if(o&&!i){const a=E(e);a&&(K("left",a),A("left",a),v("Now complete the opposite side."))}else if(i&&!o){const a=E(n);a&&(K("right",a),A("right",a),v("Now complete the opposite side."))}};function A(e,n){const o=document.getElementById("label-left"),i=document.getElementById("label-right"),a=(b,p)=>{b&&(b.textContent=p?p.toUpperCase():"",b.className=p==="truth"?"truth-label":p==="lie"?"lie-label":"")};e==="left"?(a(o,n),i&&a(i,"")):(a(i,n),o&&a(o,""))}const G=e=>[1,2,3].map(n=>document.querySelector(`.dial-slot.${e}${n}`)),M=(e,n)=>{e.dataset.symbol=n,e.style.backgroundImage=`url('img/${n}.png')`,Q(e)},H=(e,n)=>{const o=G(e).map(a=>a?.dataset.symbol||null);return[...new Set(_(o,e,n))].filter(a=>!o.includes(a))},U=()=>{if(u!=="entry")return;let e=!0;for(;e;)e=!1,["left","right"].forEach(n=>{G(n).forEach((o,i)=>{if(!o||o.dataset.symbol)return;const a=H(n,i);a.length===1&&(M(o,a[0]),e=!0,P())})});q()};s.forEach(e=>{e.addEventListener("click",()=>{if(u==="final")return;const n=Array.from(e.classList),o=n.find(f=>/^left[123]$/.test(f)),i=n.find(f=>/^right[123]$/.test(f)),a=o?"left":i?"right":null,b=o?+o.replace("left","")-1:i?+i.replace("right","")-1:null;if(!a||b==null)return;if(u==="illumination"){g.includes(e)&&e.classList.toggle("glow");return}const p=H(a,b);if(p.length===1){M(e,p[0]),P(),q(),U();return}if(c.innerHTML="",p.length===0){const f=document.createElement("div");f.textContent="No valid symbols",c.appendChild(f)}else p.forEach(f=>{const k=document.createElement("img");k.src=`img/${f}.png`,k.alt=f,k.addEventListener("click",()=>{M(e,f),l.style.display="none",P(),q(),U()}),c.appendChild(k)});l.style.display="block"})}),document.addEventListener("click",e=>{!l.contains(e.target)&&![...s].includes(e.target)&&(l.style.display="none")});function X(e,n){u="illumination",d.classList.add("glow-phase"),l.style.display="none",v("Now select the symbols that are illuminated in-game");const o=document.getElementById("label-left"),i=document.getElementById("label-right");o&&i&&(o.textContent=e.toUpperCase(),i.textContent=n.toUpperCase(),o.className=e==="truth"?"truth-label":"lie-label",i.className=n==="truth"?"truth-label":"lie-label");const a=w("left"),b=w("right");y=e==="truth"?a:b,L=e==="truth"?b:a,g=[],[...y,...L].forEach(p=>{const f=[...s].find(k=>k.dataset.symbol===p);f&&g.push(f)})}function T(){if(u!=="illumination")return;const e=[...document.querySelectorAll(".dial-slot.glow")].map(i=>i.dataset.symbol),n=y.filter(i=>e.includes(i)),o=L.filter(i=>!e.includes(i));d.classList.remove("glow-phase"),u="final",v("Follow the map to interact with the marked symbols. Click Reset to start again."),window.showMapHighlights(n,o),window.matchMedia("(orientation: landscape)").matches&&window.innerWidth<=900&&document.body.classList.add("map-full")}function D(){document.querySelectorAll(".dial-slot").forEach(n=>{n.dataset.symbol="",n.style.backgroundImage="",n.classList.remove("glow");const o=n.querySelector(".symbol-name");o&&(o.textContent="")}),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",d.classList.remove("glow-phase"),l.style.display="none",u="entry",g=[],y=[],L=[],ee(),v("Enter the symbols you see in-game");const e=document.getElementById("map-overlay");e&&(e.innerHTML=""),N(h.checked),document.body.classList.remove("map-full")}window.handleLock=T,window.resetDial=D,d.addEventListener("click",T),t.addEventListener("click",D);function q(){if(!J())return;const e=w("left"),n=w("right"),o=E(e),i=E(n);!e.some(p=>n.includes(p))&&(o==="truth"&&i==="lie"||o==="lie"&&i==="truth")?X(o,i):v("Both sides must be opposite types with no duplicate symbols across the dial.")}window.addEventListener("orientationchange",()=>{u==="final"&&window.innerWidth<=900&&window.matchMedia("(orientation: landscape)").matches?document.body.classList.add("map-full"):document.body.classList.remove("map-full")})});
