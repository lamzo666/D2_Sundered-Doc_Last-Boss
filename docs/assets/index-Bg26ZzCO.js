(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&d(u)}).observe(document,{childList:!0,subtree:!0});function a(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?c.credentials="include":t.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(t){if(t.ep)return;t.ep=!0;const c=a(t);fetch(t.href,c)}})();const C=Object.freeze([["pyramid","drink","worm"],["pyramid","kill","worm"],["pyramid","stop","savathun"],["pyramid","give","darkness"],["guardian","worship","light"],["guardian","worship","traveller"],["guardian","kill","witness"],["traveller","give","guardian"],["traveller","give","light"],["hive","worship","darkness"],["hive","worship","worm"],["darkness","stop","savathun"]]),I=Object.freeze([["hive","kill","worm"],["hive","kill","light"],["hive","give","darkness"],["hive","stop","witness"],["traveller","kill","guardian"],["traveller","drink","worm"],["traveller","give","hive"],["traveller","stop","witness"],["pyramid","drink","guardian"],["pyramid","stop","witness"],["witness","drink","light"],["witness","kill","pyramid"],["guardian","worship","witness"],["guardian","kill","traveller"],["savathun","drink","darkness"],["savathun","stop","darkness"],["light","stop","savathun"]]);let B=null,N=null;const D=(n,s)=>n.length===s.length&&n.every((a,d)=>a===s[d]),Z=n=>C.some(s=>D(s,n))?"truth":I.some(s=>D(s,n))?"lie":null,W=n=>[1,2,3].map(s=>document.querySelector(`.dial-slot.${n}${s}`)?.dataset.symbol||null),R=(n,s)=>n.filter(a=>a.every((d,t)=>!s[t]||s[t]===d)),_=(n,s)=>{const a=new Set(n);return!s.some(d=>a.has(d))};function V(n){return B?B===n?N==="truth"?[C]:[I]:N==="truth"?[I]:[C]:[C,I]}function K(n,s){const a=[...new Set(V("left").flatMap(t=>R(t,n).map(c=>c.join("|"))))].map(t=>t.split("|")),d=[...new Set(V("right").flatMap(t=>R(t,s).map(c=>c.join("|"))))].map(t=>t.split("|"));if(!a.length||!d.length)return!1;for(const t of a)for(const c of d)if(_(t,c))return!0;return!1}function ee(n,s,a){if(a<0||a>2)return[];const d=s==="left"?[...n]:W("left"),t=s==="right"?[...n]:W("right"),c=R(V(s).flat(),s==="left"?d:t),u=[...new Set(c.map(m=>m[a]))],g=new Set(n.filter(Boolean)),p=[];for(const m of u)if(!g.has(m))if(s==="left"){const y=[...d];y[a]=m,K(y,t)&&p.push(m)}else{const y=[...t];y[a]=m,K(d,y)&&p.push(m)}return p}function S(n){return Z(n)}function J(n,s){B=n,N=s}function te(){B=null,N=null}const O={stop:{top:"22.31%",left:"38.64%"},kill:{top:"70.14%",left:"65.96%"},darkness:{top:"39.91%",left:"80.93%"},drink:{top:"1.74%",left:"56.29%"},give:{top:"22.31%",left:"53.32%"},guardian:{top:"45.96%",left:"19.49%"},hive:{top:"29.77%",left:"19.53%"},light:{top:"59.68%",left:"72.98%"},pyramid:{top:"62.75%",left:"2.15%"},savathun:{top:"5.32%",left:"92.50%"},traveller:{top:"87.52%",left:"19.53%"},witness:{top:"30.20%",left:"2.00%"},worm:{top:"7.16%",left:"75.20%"},worship:{top:"70.42%",left:"31.45%"}};function oe(n,s){const a=document.getElementById("map-overlay");a.innerHTML="";const d=(t,c)=>{if(!O[t])return;const u=document.createElement("div");u.className=`symbol-wrap pulse ${c}`,u.style.top=O[t].top,u.style.left=O[t].left;const g=document.createElement("img");g.className="symbol-overlay",g.src=`img/${t}.png`,g.alt=t,u.appendChild(g);const p=document.createElement("div");p.className="map-label",p.textContent=t.toUpperCase(),u.appendChild(p),a.appendChild(u)};n.forEach(t=>d(t,"truth")),s.forEach(t=>d(t,"lie"))}window.showMapHighlights=oe;window.addEventListener("DOMContentLoaded",()=>{const n=()=>{const e="calc(var(--truthlie-font-base) * var(--dial-scale) * var(--truthlie-mult))",o=document.createElement("div");o.style.position="absolute",o.style.visibility="hidden",o.style.fontSize=e,document.body.appendChild(o);const l=getComputedStyle(o).fontSize;o.remove();const i=document.getElementById("label-left"),r=document.getElementById("label-right");i&&i.style.setProperty("font-size",l,"important"),r&&r.style.setProperty("font-size",l,"important")};n(),window.addEventListener("resize",n);const s=document.querySelectorAll(".dial-slot"),a=document.getElementById("symbolPopup"),d=document.getElementById("popupGrid"),t=document.getElementById("lockButton"),c=document.querySelector(".btn-reset"),u=document.getElementById("tooltip"),g=document.getElementById("tooltipCheckbox"),p=document.getElementById("symbolNamesCheckbox");let m="entry",y=[],E=[],L=[];localStorage.getItem("firstVisitDone")!=="true"&&(localStorage.setItem("tooltipVisible","true"),localStorage.setItem("showSymbolNames","true"),localStorage.setItem("firstVisitDone","true"));const A=(localStorage.getItem("tooltipVisible")??"true")==="true";g.checked=A,u.classList.toggle("hidden",!A),g.addEventListener("change",()=>{const e=g.checked;u.classList.toggle("hidden",!e),localStorage.setItem("tooltipVisible",e?"true":"false")});const w=e=>{u&&(u.textContent=e)},j=(localStorage.getItem("showSymbolNames")??"true")==="true";p.checked=j;function P(e){document.querySelectorAll(".dial-slot .symbol-name, .map-label").forEach(o=>{o.style.display=e?"block":"none"})}P(j),p.addEventListener("change",()=>{const e=p.checked;localStorage.setItem("showSymbolNames",e?"true":"false"),P(e)});const v=e=>[document.querySelector(`.dial-slot.${e}1`)?.dataset.symbol||null,document.querySelector(`.dial-slot.${e}2`)?.dataset.symbol||null,document.querySelector(`.dial-slot.${e}3`)?.dataset.symbol||null],Q=()=>v("left").every(Boolean)&&v("right").every(Boolean);function X(e){const o=(e.dataset.symbol||"").toUpperCase();let l=e.querySelector(".symbol-name");l||(l=document.createElement("div"),l.className="symbol-name",e.appendChild(l)),l.textContent=o,l.style.display=p.checked?"block":"none"}const M=()=>{if(m!=="entry")return;const e=v("left"),o=v("right"),l=e.every(Boolean),i=o.every(Boolean);if(l&&!i){const r=S(e);r&&(J("left",r),z("left",r),w("Now complete the opposite side."))}else if(i&&!l){const r=S(o);r&&(J("right",r),z("right",r),w("Now complete the opposite side."))}};function z(e,o){const l=document.getElementById("label-left"),i=document.getElementById("label-right"),r=(b,f)=>{b&&(b.textContent=f?f.toUpperCase():"",b.className=f==="truth"?"truth-label":f==="lie"?"lie-label":"")};e==="left"?(r(l,o),i&&r(i,"")):(r(i,o),l&&r(l,""))}const G=e=>[1,2,3].map(o=>document.querySelector(`.dial-slot.${e}${o}`)),q=(e,o)=>{e.dataset.symbol=o,e.style.backgroundImage=`url('img/${o}.png')`,X(e)},H=(e,o)=>{const l=G(e).map(r=>r?.dataset.symbol||null);return[...new Set(ee(l,e,o))].filter(r=>!l.includes(r))},T=()=>{if(m!=="entry")return;let e=!0;for(;e;)e=!1,["left","right"].forEach(o=>{G(o).forEach((l,i)=>{if(!l||l.dataset.symbol)return;const r=H(o,i);r.length===1&&(q(l,r[0]),e=!0,M())})});$()},x=[...s];x.forEach(e=>{e.addEventListener("click",()=>{if(m==="final")return;const o=Array.from(e.classList),l=o.find(h=>/^left[123]$/.test(h)),i=o.find(h=>/^right[123]$/.test(h)),r=l?"left":i?"right":null,b=l?+l.replace("left","")-1:i?+i.replace("right","")-1:null;if(!r||b==null)return;if(m==="illumination"){y.includes(e)&&e.classList.toggle("glow");return}const f=H(r,b);if(f.length===1){q(e,f[0]),M(),$(),T();return}if(d.innerHTML="",f.length===0){const h=document.createElement("div");h.textContent="No valid symbols",d.appendChild(h)}else f.forEach(h=>{const k=document.createElement("img");k.src=`img/${h}.png`,k.alt=h,k.addEventListener("click",()=>{q(e,h),a.style.display="none",M(),$(),T()}),d.appendChild(k)});a.style.display="block"})}),document.addEventListener("click",e=>{!a.contains(e.target)&&!x.includes(e.target)&&(a.style.display="none")});function Y(e,o){m="illumination",t.classList.add("glow-phase"),a.style.display="none",w("Now select the symbols that are illuminated in-game");const l=document.getElementById("label-left"),i=document.getElementById("label-right");l&&i&&(l.textContent=e.toUpperCase(),i.textContent=o.toUpperCase(),l.className=e==="truth"?"truth-label":"lie-label",i.className=o==="truth"?"truth-label":"lie-label",n());const r=v("left"),b=v("right");E=e==="truth"?r:b,L=e==="truth"?b:r,y=[],[...E,...L].forEach(f=>{const h=x.find(k=>k.dataset.symbol===f);h&&y.push(h)})}function U(){if(m!=="illumination")return;const e=[...document.querySelectorAll(".dial-slot.glow")].map(i=>i.dataset.symbol),o=E.filter(i=>e.includes(i)),l=L.filter(i=>!e.includes(i));t.classList.remove("glow-phase"),m="final",w("Follow the map to interact with the marked symbols. Click Reset to start again."),window.showMapHighlights(o,l),window.matchMedia("(orientation: landscape)").matches&&window.innerWidth<=900&&document.body.classList.add("map-full")}function F(){document.querySelectorAll(".dial-slot").forEach(o=>{o.dataset.symbol="",o.style.backgroundImage="",o.classList.remove("glow");const l=o.querySelector(".symbol-name");l&&(l.textContent="")}),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",t.classList.remove("glow-phase"),a.style.display="none",m="entry",y=[],E=[],L=[],te(),w("Enter the symbols you see in-game");const e=document.getElementById("map-overlay");e&&(e.innerHTML=""),P(p.checked),document.body.classList.remove("map-full"),n()}window.handleLock=U,window.resetDial=F,t.addEventListener("click",U),c.addEventListener("click",F);function $(){if(!Q())return;const e=v("left"),o=v("right"),l=S(e),i=S(o);!e.some(f=>o.includes(f))&&(l==="truth"&&i==="lie"||l==="lie"&&i==="truth")?Y(l,i):w("Both sides must be opposite types with no duplicate symbols across the dial.")}window.addEventListener("orientationchange",()=>{m==="final"&&window.innerWidth<=900&&window.matchMedia("(orientation: landscape)").matches?document.body.classList.add("map-full"):document.body.classList.remove("map-full")})});
