(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function d(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?a.credentials="include":l.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(l){if(l.ep)return;l.ep=!0;const a=d(l);fetch(l.href,a)}})();const S=[["pyramid","drink","worm"],["pyramid","kill","worm"],["pyramid","stop","savathun"],["pyramid","give","darkness"],["guardian","worship","light"],["guardian","worship","traveller"],["guardian","kill","witness"],["traveller","give","guardian"],["traveller","give","light"],["hive","worship","darkness"],["hive","worship","worm"],["darkness","stop","savathun"]],C=[["hive","kill","worm"],["hive","kill","light"],["hive","give","darkness"],["hive","stop","witness"],["traveller","kill","guardian"],["traveller","drink","worm"],["traveller","give","hive"],["traveller","stop","witness"],["pyramid","drink","guardian"],["pyramid","stop","witness"],["witness","drink","light"],["witness","kill","pyramid"],["guardian","worship","witness"],["guardian","kill","traveller"],["savathun","drink","darkness"],["savathun","stop","darkness"],["light","stop","savathun"]];let B=null,I=null;function J(r,n,d){if(d<0||d>2)return[];let c=X(n);const l=new Set(V(n));c=c.filter(g=>g.every(b=>!l.has(b)));const a=c.filter(g=>g.every((b,w)=>w===d||!r[w]||r[w]===b)),u=[...new Set(a.map(g=>g[d]))],f=new Set(r.filter(Boolean));return u.filter(g=>!f.has(g))}function V(r){const n=r==="left"?"right":"left";return[`${n}1`,`${n}2`,`${n}3`].map(l=>document.querySelector(`.dial-slot.${l}`)?.dataset.symbol||null).filter(Boolean)}function E(r){return S.find(n=>T(n,r))?"truth":C.find(n=>T(n,r))?"lie":null}function j(r,n){B=r,I=n}function Q(){B=null,I=null}function X(r){const n=V("left"),d=V("right"),c=n.length===3,l=d.length===3;return!B||!c||!l?[...S,...C]:B===r?I==="truth"?S:C:I==="truth"?C:S}function T(r,n){return r.length===n.length&&r.every((d,c)=>d===n[c])}const P={stop:{top:"22.31%",left:"38.64%"},kill:{top:"70.14%",left:"65.96%"},darkness:{top:"39.91%",left:"80.93%"},drink:{top:"1.74%",left:"56.29%"},give:{top:"22.31%",left:"53.32%"},guardian:{top:"45.96%",left:"19.49%"},hive:{top:"29.77%",left:"19.53%"},light:{top:"59.68%",left:"72.98%"},pyramid:{top:"62.75%",left:"2.15%"},savathun:{top:"5.32%",left:"92.50%"},traveller:{top:"87.52%",left:"19.53%"},witness:{top:"30.20%",left:"2.00%"},worm:{top:"7.16%",left:"75.20%"},worship:{top:"70.42%",left:"31.45%"}};function Y(r,n){const d=document.getElementById("map-overlay");d.innerHTML="";const c=(l,a)=>{if(!P[l])return;const u=document.createElement("div");u.className=`symbol-wrap pulse ${a}`,u.style.top=P[l].top,u.style.left=P[l].left;const f=document.createElement("img");f.className="symbol-overlay",f.src=`img/${l}.png`,f.alt=l,u.appendChild(f);const m=document.createElement("div");m.className="map-label",m.textContent=l.toUpperCase(),u.appendChild(m),d.appendChild(u)};r.forEach(l=>c(l,"truth")),n.forEach(l=>c(l,"lie"))}window.showMapHighlights=Y;window.addEventListener("DOMContentLoaded",()=>{const r=document.querySelectorAll(".dial-slot"),n=document.getElementById("symbolPopup"),d=document.getElementById("popupGrid"),c=document.getElementById("lockButton"),l=document.querySelector(".btn-reset"),a=document.getElementById("tooltip"),u=document.getElementById("tooltipCheckbox"),f=document.getElementById("symbolNamesCheckbox");let m="entry",g=[],b=[],w=[];localStorage.getItem("firstVisitDone")!=="true"&&(localStorage.setItem("tooltipVisible","true"),localStorage.setItem("showSymbolNames","true"),localStorage.setItem("firstVisitDone","true"));const M=localStorage.getItem("tooltipVisible")!=="false";u.checked=M,a.classList.toggle("hidden",!M),u.addEventListener("change",()=>{const e=u.checked;a.classList.toggle("hidden",!e),localStorage.setItem("tooltipVisible",e?"true":"false")});const k=e=>{a&&(a.textContent=e)},O=localStorage.getItem("showSymbolNames"),A=O===null?!0:O==="true";f.checked=A;function N(e){document.querySelectorAll(".dial-slot .symbol-name, .map-label").forEach(o=>{o.style.display=e?"block":"none"})}N(A),f.addEventListener("change",()=>{const e=f.checked;localStorage.setItem("showSymbolNames",e?"true":"false"),N(e)});const v=e=>[document.querySelector(`.dial-slot.${e}1`)?.dataset.symbol||null,document.querySelector(`.dial-slot.${e}2`)?.dataset.symbol||null,document.querySelector(`.dial-slot.${e}3`)?.dataset.symbol||null],W=()=>v("left").every(Boolean)&&v("right").every(Boolean);function K(e){const o=(e.dataset.symbol||"").toUpperCase();let t=e.querySelector(".symbol-name");t||(t=document.createElement("div"),t.className="symbol-name",e.appendChild(t)),t.textContent=o,t.style.display=f.checked?"block":"none"}const $=()=>{if(m!=="entry")return;const e=v("left"),o=v("right"),t=e.every(Boolean),s=o.every(Boolean);if(t&&!s){const i=E(e);i&&(j("left",i),R("left",i),k("Now complete the opposite side."))}else if(s&&!t){const i=E(o);i&&(j("right",i),R("right",i),k("Now complete the opposite side."))}};function R(e,o){const t=document.getElementById("label-left"),s=document.getElementById("label-right"),i=(y,p)=>{y&&(y.textContent=p?p.toUpperCase():"",y.className=p==="truth"?"truth-label":p==="lie"?"lie-label":"")};e==="left"?(i(t,o),s&&i(s,"")):(i(s,o),t&&i(t,""))}const U=e=>[1,2,3].map(o=>document.querySelector(`.dial-slot.${e}${o}`)),q=(e,o)=>{e.dataset.symbol=o,e.style.backgroundImage=`url('img/${o}.png')`,K(e)},G=(e,o)=>{const t=U(e).map(i=>i?.dataset.symbol||null);return[...new Set(J(t,e,o))].filter(i=>!t.includes(i))},H=()=>{if(m!=="entry")return;let e=!0;for(;e;)e=!1,["left","right"].forEach(o=>{U(o).forEach((t,s)=>{if(!t||t.dataset.symbol)return;const i=G(o,s);i.length===1&&(q(t,i[0]),e=!0,$())})});x()};r.forEach(e=>{e.addEventListener("click",()=>{if(m==="final")return;const o=Array.from(e.classList),t=o.find(h=>/^left[123]$/.test(h)),s=o.find(h=>/^right[123]$/.test(h)),i=t?"left":s?"right":null,y=t?+t.replace("left","")-1:s?+s.replace("right","")-1:null;if(!i||y==null)return;if(m==="illumination"){g.includes(e)&&e.classList.toggle("glow");return}const p=G(i,y);if(p.length===1){q(e,p[0]),$(),x(),H();return}if(d.innerHTML="",p.length===0){const h=document.createElement("div");h.textContent="No valid symbols",d.appendChild(h)}else p.forEach(h=>{const L=document.createElement("img");L.src=`img/${h}.png`,L.alt=h,L.addEventListener("click",()=>{q(e,h),n.style.display="none",$(),x(),H()}),d.appendChild(L)});n.style.display="block"})}),document.addEventListener("click",e=>{!n.contains(e.target)&&![...r].includes(e.target)&&(n.style.display="none")});function z(e,o){m="illumination",c.classList.add("glow-phase"),n.style.display="none",k("Now select the symbols that are illuminated in-game");const t=document.getElementById("label-left"),s=document.getElementById("label-right");t&&s&&(t.textContent=e.toUpperCase(),s.textContent=o.toUpperCase(),t.className=e==="truth"?"truth-label":"lie-label",s.className=o==="truth"?"truth-label":"lie-label");const i=v("left"),y=v("right");b=e==="truth"?i:y,w=e==="truth"?y:i,g=[],[...b,...w].forEach(p=>{const h=[...r].find(L=>L.dataset.symbol===p);h&&g.push(h)})}function D(){if(m!=="illumination")return;const e=[...document.querySelectorAll(".dial-slot.glow")].map(s=>s.dataset.symbol),o=b.filter(s=>e.includes(s)),t=w.filter(s=>!e.includes(s));c.classList.remove("glow-phase"),m="final",k("Follow the map to interact with the marked symbols. Click Reset to start again."),window.showMapHighlights(o,t),window.matchMedia("(orientation: landscape)").matches&&window.innerWidth<=900&&document.body.classList.add("map-full")}function F(){document.querySelectorAll(".dial-slot").forEach(o=>{o.dataset.symbol="",o.style.backgroundImage="",o.classList.remove("glow");const t=o.querySelector(".symbol-name");t&&(t.textContent="")}),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",c.classList.remove("glow-phase"),n.style.display="none",m="entry",g=[],b=[],w=[],Q(),k("Enter the symbols you see in-game");const e=document.getElementById("map-overlay");e&&(e.innerHTML=""),N(f.checked),document.body.classList.remove("map-full")}window.handleLock=D,window.resetDial=F,c.addEventListener("click",D),l.addEventListener("click",F);function x(){if(!W())return;const e=v("left"),o=v("right"),t=E(e),s=E(o);!e.some(p=>o.includes(p))&&(t==="truth"&&s==="lie"||t==="lie"&&s==="truth")?z(t,s):k("Both sides must be opposite types with no duplicate symbols across the dial.")}window.addEventListener("orientationchange",()=>{m==="final"&&window.innerWidth<=900&&window.matchMedia("(orientation: landscape)").matches?document.body.classList.add("map-full"):document.body.classList.remove("map-full")})});
