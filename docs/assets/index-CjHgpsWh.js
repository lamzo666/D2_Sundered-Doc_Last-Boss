(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const d of t)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function s(t){const d={};return t.integrity&&(d.integrity=t.integrity),t.referrerPolicy&&(d.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?d.credentials="include":t.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(t){if(t.ep)return;t.ep=!0;const d=s(t);fetch(t.href,d)}})();const x=Object.freeze([["pyramid","drink","worm"],["pyramid","kill","worm"],["pyramid","stop","savathun"],["pyramid","give","darkness"],["guardian","worship","light"],["guardian","worship","traveller"],["guardian","kill","witness"],["traveller","give","guardian"],["traveller","give","light"],["hive","worship","darkness"],["hive","worship","worm"],["darkness","stop","savathun"]]),M=Object.freeze([["hive","kill","worm"],["hive","kill","light"],["hive","give","darkness"],["hive","stop","witness"],["traveller","kill","guardian"],["traveller","drink","worm"],["traveller","give","hive"],["traveller","stop","witness"],["pyramid","drink","guardian"],["pyramid","stop","witness"],["witness","drink","light"],["witness","kill","pyramid"],["guardian","worship","witness"],["guardian","kill","traveller"],["savathun","drink","darkness"],["savathun","stop","darkness"],["light","stop","savathun"]]);let N=null,P=null;const K=(l,i)=>l.length===i.length&&l.every((s,c)=>s===i[c]),re=l=>x.some(i=>K(i,l))?"truth":M.some(i=>K(i,l))?"lie":null,J=l=>[1,2,3].map(i=>document.querySelector(`.dial-slot.${l}${i}`)?.dataset.symbol||null),F=(l,i)=>l.filter(s=>s.every((c,t)=>!i[t]||i[t]===c)),ce=(l,i)=>{const s=new Set(l);return!i.some(c=>s.has(c))};function V(l){return N?N===l?P==="truth"?[x]:[M]:P==="truth"?[M]:[x]:[x,M]}function Q(l,i){const s=[...new Set(V("left").flatMap(t=>F(t,l).map(d=>d.join("|"))))].map(t=>t.split("|")),c=[...new Set(V("right").flatMap(t=>F(t,i).map(d=>d.join("|"))))].map(t=>t.split("|"));if(!s.length||!c.length)return!1;for(const t of s)for(const d of c)if(ce(t,d))return!0;return!1}function de(l,i,s){if(s<0||s>2)return[];const c=i==="left"?[...l]:J("left"),t=i==="right"?[...l]:J("right"),d=F(V(i).flat(),i==="left"?c:t),f=[...new Set(d.map(u=>u[s]))],g=new Set(l.filter(Boolean)),h=[];for(const u of f)if(!g.has(u))if(i==="left"){const b=[...c];b[s]=u,Q(b,t)&&h.push(u)}else{const b=[...t];b[s]=u,Q(c,b)&&h.push(u)}return h}function B(l){return re(l)}function X(l,i){N=l,P=i}function Y(){N=null,P=null}const ue={stop:{top:"22.31%",left:"38.64%"},kill:{top:"70.14%",left:"65.96%"},darkness:{top:"39.91%",left:"80.93%"},drink:{top:"1.74%",left:"56.29%"},give:{top:"22.31%",left:"53.32%"},guardian:{top:"45.96%",left:"19.49%"},hive:{top:"29.77%",left:"19.53%"},light:{top:"59.68%",left:"72.98%"},pyramid:{top:"62.75%",left:"2.15%"},savathun:{top:"5.32%",left:"92.50%"},traveller:{top:"87.52%",left:"19.53%"},witness:{top:"30.20%",left:"2.00%"},worm:{top:"7.16%",left:"75.20%"},worship:{top:"70.42%",left:"31.45%"}},I={defaultDesktop:"below",defaultMobile:"below",desktopAbove:["hive","drink","witness","pyramid","worm"],mobileAbove:["hive","drink","witness","pyramid","worm"]};function Z(){return window.matchMedia("(max-width: 640px)").matches}function $(){const l=new Set(Z()?I.mobileAbove:I.desktopAbove),i=(Z()?I.defaultMobile:I.defaultDesktop)==="above";document.querySelectorAll(".symbol-wrap").forEach(s=>{const c=s.dataset.symbol,t=l.has(c)||i;s.classList.toggle("label-above",t),s.classList.toggle("label-below",!t)})}function me(l=[],i=[]){const s=document.getElementById("map-overlay");if(!s)return;s.innerHTML="";const c=(t,d)=>{const f=ue[t];if(!f)return;const g=document.createElement("div");g.className=`symbol-wrap ${d}`,g.dataset.symbol=t,g.style.top=f.top,g.style.left=f.left;const h=document.createElement("img");h.className="symbol-overlay",h.src=`img/${t}.png`,h.alt=t,g.appendChild(h);const u=document.createElement("div");u.className="map-label",u.textContent=t.toUpperCase(),g.appendChild(u),s.appendChild(g)};l.forEach(t=>c(t,"truth")),i.forEach(t=>c(t,"lie")),$()}window.addEventListener("resize",$);window.addEventListener("orientationchange",$);window.showMapHighlights=me;window.addEventListener("DOMContentLoaded",()=>{const l=()=>{const e=document.querySelector(".dial");if(!e)return;const o=e.getBoundingClientRect().width,n=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--truthlie-coef"))||.085,a=Math.max(10,Math.round(o*n))+"px",r=document.getElementById("label-left"),p=document.getElementById("label-right");r&&r.style.setProperty("font-size",a,"important"),p&&p.style.setProperty("font-size",a,"important")};requestAnimationFrame(l),window.addEventListener("resize",l);const i=document.querySelectorAll(".dial-slot"),s=document.getElementById("symbolPopup"),c=document.getElementById("popupGrid"),t=document.getElementById("lockButton"),d=document.querySelector(".btn-reset"),f=document.getElementById("tooltip"),g=document.getElementById("tooltipCheckbox"),h=document.getElementById("symbolNamesCheckbox");let u="entry",b=[],L=[],S=[];localStorage.getItem("firstVisitDone")!=="true"&&(localStorage.setItem("tooltipVisible","true"),localStorage.setItem("showSymbolNames","true"),localStorage.setItem("firstVisitDone","true"));const j=(localStorage.getItem("tooltipVisible")??"true")==="true";g.checked=j,f.classList.toggle("hidden",!j),g.addEventListener("change",()=>{const e=g.checked;f.classList.toggle("hidden",!e),localStorage.setItem("tooltipVisible",e?"true":"false")});const v=e=>{f&&(f.textContent=e)},T=(localStorage.getItem("showSymbolNames")??"true")==="true";h.checked=T;function A(e){document.querySelectorAll(".dial-slot .symbol-name, .map-label").forEach(o=>{o.style.display=e?"block":"none"})}A(T),h.addEventListener("change",()=>{const e=h.checked;localStorage.setItem("showSymbolNames",e?"true":"false"),A(e)});const z=e=>[1,2,3].map(o=>document.querySelector(`.dial-slot.${e}${o}`)),w=e=>z(e).map(o=>o?.dataset.symbol||null),ee=()=>w("left").every(Boolean)&&w("right").every(Boolean);function te(e){const o=(e.dataset.symbol||"").toUpperCase();let n=e.querySelector(".symbol-name");n||(n=document.createElement("div"),n.className="symbol-name",e.appendChild(n)),n.textContent=o,n.style.display=h.checked?"block":"none"}const q=(e,o)=>{e.dataset.symbol=o||"",e.style.backgroundImage=o?`url('img/${o}.png')`:"",te(e)};function D(e,o,n){const a=[...new Set(de(e,o,n))],r=new Set(e.filter(Boolean));return a.filter(p=>!r.has(p))}function oe(e,o){const n=w(e);return n[o]=null,D(n,e,o)}function G(e,o){const n=w(e);return D(n,e,o)}const H=()=>{if(u!=="entry")return;const e=w("left"),o=w("right"),n=e.every(Boolean),a=o.every(Boolean);if(n&&!a){const r=B(e);r&&(X("left",r),U("left",r),v("Now complete the opposite side."))}else if(a&&!n){const r=B(o);r&&(X("right",r),U("right",r),v("Now complete the opposite side."))}};function U(e,o){const n=document.getElementById("label-left"),a=document.getElementById("label-right"),r=(p,y)=>{p&&(p.textContent=y?y.toUpperCase():"",p.className=y==="truth"?"truth-label":y==="lie"?"lie-label":"")};e==="left"?(r(n,o),a&&r(a,"")):(r(a,o),n&&r(n,"")),l()}const ne=()=>{if(u!=="entry")return;let e=!0;for(;e;)e=!1,["left","right"].forEach(o=>{z(o).forEach((n,a)=>{if(!n||n.dataset.symbol)return;const r=G(o,a);r.length===1&&(q(n,r[0]),e=!0,H())})});R()};[...i].forEach(e=>{e.addEventListener("click",()=>{if(u==="final")return;const o=Array.from(e.classList),n=o.find(m=>/^left[123]$/.test(m)),a=o.find(m=>/^right[123]$/.test(m)),r=n?"left":a?"right":null,p=n?+n.replace("left","")-1:a?+a.replace("right","")-1:null;if(!r||p==null)return;if(u==="illumination"){b.includes(e)&&e.classList.toggle("glow");return}const y=!!e.dataset.symbol;let E=y?oe(r,p):G(r,p);if(y&&E.length===0&&e.dataset.symbol&&(E=[e.dataset.symbol]),c.innerHTML="",y){const m=document.createElement("div");m.textContent="Clear",Object.assign(m.style,{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",background:"#333",border:"1px solid #777",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"700"}),m.addEventListener("click",()=>{q(e,""),s.style.display="none",Y(),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",v("Enter the symbols you see in-game"),l(),R()}),c.appendChild(m)}if(E.length===0){const m=document.createElement("div");m.textContent="No valid symbols",c.appendChild(m)}else E.forEach(m=>{const C=document.createElement("img");C.src=`img/${m}.png`,C.alt=m,C.addEventListener("click",()=>{q(e,m),s.style.display="none",H(),R(),ne()}),c.appendChild(C)});s.style.display="block"})}),document.addEventListener("click",e=>{!s.contains(e.target)&&![...i].includes(e.target)&&(s.style.display="none")});const k=document.createElement("div");k.id="rotatePrompt",k.className="rotate-prompt",k.textContent="Rotate device to view map",document.body.appendChild(k);function O(e){k.classList.toggle("show",!!e)}async function le(){try{document.documentElement.requestFullscreen&&!document.fullscreenElement&&await document.documentElement.requestFullscreen(),screen.orientation&&screen.orientation.lock&&await screen.orientation.lock("landscape")}catch{}}async function ie(){window.innerWidth<=900&&(document.body.classList.add("map-only"),await le(),O(window.matchMedia("(orientation: portrait)").matches))}function se(){document.body.classList.remove("map-only"),O(!1),document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen().catch(()=>{})}window.addEventListener("orientationchange",()=>{document.body.classList.contains("map-only")&&O(window.matchMedia("(orientation: portrait)").matches)});function ae(e,o){u="illumination",t.classList.add("glow-phase"),s.style.display="none",v("Now select the symbols that are illuminated in-game");const n=document.getElementById("label-left"),a=document.getElementById("label-right");n&&a&&(n.textContent=e.toUpperCase(),a.textContent=o.toUpperCase(),n.className=e==="truth"?"truth-label":"lie-label",a.className=o==="truth"?"truth-label":"lie-label",l());const r=w("left"),p=w("right");L=e==="truth"?r:p,S=e==="truth"?p:r,b=[],[...L,...S].forEach(y=>{const E=[...i].find(m=>m.dataset.symbol===y);E&&b.push(E)})}function W(){if(u!=="illumination")return;const e=[...document.querySelectorAll(".dial-slot.glow")].map(a=>a.dataset.symbol),o=L.filter(a=>e.includes(a)),n=S.filter(a=>!e.includes(a));t.classList.remove("glow-phase"),u="final",v("Follow the map to interact with the marked symbols. Tap Reset to start again."),window.showMapHighlights(o,n),ie()}function _(){document.querySelectorAll(".dial-slot").forEach(o=>{o.dataset.symbol="",o.style.backgroundImage="",o.classList.remove("glow");const n=o.querySelector(".symbol-name");n&&(n.textContent="")}),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",t.classList.remove("glow-phase"),s.style.display="none",u="entry",b=[],L=[],S=[],Y(),v("Enter the symbols you see in-game");const e=document.getElementById("map-overlay");e&&(e.innerHTML=""),A(h.checked),se(),l()}window.handleLock=W,window.resetDial=_,t.addEventListener("click",W),d.addEventListener("click",_);function R(){if(!ee())return;const e=w("left"),o=w("right"),n=B(e),a=B(o);!e.some(y=>o.includes(y))&&(n==="truth"&&a==="lie"||n==="lie"&&a==="truth")?ae(n,a):v("Both sides must be opposite types with no duplicate symbols across the dial.")}});
