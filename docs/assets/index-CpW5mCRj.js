(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))d(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const y of i.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&d(y)}).observe(document,{childList:!0,subtree:!0});function m(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(l){if(l.ep)return;l.ep=!0;const i=m(l);fetch(l.href,i)}})();const T=Object.freeze([["pyramid","drink","worm"],["pyramid","kill","worm"],["pyramid","stop","savathun"],["pyramid","give","darkness"],["guardian","worship","light"],["guardian","worship","traveller"],["guardian","kill","witness"],["traveller","give","guardian"],["traveller","give","light"],["hive","worship","darkness"],["hive","worship","worm"],["darkness","stop","savathun"]]),V=Object.freeze([["hive","kill","worm"],["hive","kill","light"],["hive","give","darkness"],["hive","stop","witness"],["traveller","kill","guardian"],["traveller","drink","worm"],["traveller","give","hive"],["traveller","stop","witness"],["pyramid","drink","guardian"],["pyramid","stop","witness"],["witness","drink","light"],["witness","kill","pyramid"],["guardian","worship","witness"],["guardian","kill","traveller"],["savathun","drink","darkness"],["savathun","stop","darkness"],["light","stop","savathun"]]);let _=null,D=null;const ne=(s,a)=>s.length===a.length&&s.every((m,d)=>m===a[d]),be=s=>T.some(a=>ne(a,s))?"truth":V.some(a=>ne(a,s))?"lie":null,le=s=>[1,2,3].map(a=>document.querySelector(`.dial-slot.${s}${a}`)?.dataset.symbol||null),G=(s,a)=>s.filter(m=>m.every((d,l)=>!a[l]||a[l]===d)),ve=(s,a)=>{const m=new Set(s);return!a.some(d=>m.has(d))};function U(s){return _?_===s?D==="truth"?[T]:[V]:D==="truth"?[V]:[T]:[T,V]}function ie(s,a){const m=[...new Set(U("left").flatMap(l=>G(l,s).map(i=>i.join("|"))))].map(l=>l.split("|")),d=[...new Set(U("right").flatMap(l=>G(l,a).map(i=>i.join("|"))))].map(l=>l.split("|"));if(!m.length||!d.length)return!1;for(const l of m)for(const i of d)if(ve(l,i))return!0;return!1}function Ee(s,a,m){if(m<0||m>2)return[];const d=a==="left"?[...s]:le("left"),l=a==="right"?[...s]:le("right"),i=G(U(a).flat(),a==="left"?d:l),y=[...new Set(i.map(g=>g[m]))],E=new Set(s.filter(Boolean)),f=[];for(const g of y)if(!E.has(g))if(a==="left"){const w=[...d];w[m]=g,ie(w,l)&&f.push(g)}else{const w=[...l];w[m]=g,ie(d,w)&&f.push(g)}return f}function q(s){return be(s)}function se(s,a){_=s,D=a}function ae(){_=null,D=null}window.MAP_COORDS={stop:{top:"22.31%",left:"38.64%"},kill:{top:"70.14%",left:"65.96%"},darkness:{top:"39.91%",left:"80.93%"},drink:{top:"1.74%",left:"56.29%"},give:{top:"22.31%",left:"53.32%"},guardian:{top:"45.96%",left:"19.49%"},hive:{top:"29.77%",left:"19.53%"},light:{top:"59.68%",left:"72.98%"},pyramid:{top:"62.75%",left:"2.15%"},savathun:{top:"5.32%",left:"92.50%"},traveller:{top:"87.52%",left:"19.53%"},witness:{top:"30.20%",left:"2.00%"},worm:{top:"7.16%",left:"75.20%"},worship:{top:"70.42%",left:"31.45%"}};window.SYMBOL_NAME_MAP={stop:"STOP",kill:"KILL",darkness:"DARKNESS",drink:"DRINK",give:"GIVE",guardian:"GUARDIAN",hive:"HIVE",light:"LIGHT",pyramid:"PYRAMID",savathun:"SAVATHUN",traveller:"TRAVELLER",witness:"WITNESS",worm:"WORM",worship:"WORSHIP"};const $={defaultDesktop:"below",defaultMobile:"below",desktopAbove:["hive","drink","witness","pyramid","worm"],mobileAbove:["hive","drink","witness","pyramid","worm"]};function re(){return window.matchMedia("(max-width: 640px)").matches}function W(){const s=re()?$.mobileAbove:$.desktopAbove,a=(re()?$.defaultMobile:$.defaultDesktop)==="above",m=new Set(s);document.querySelectorAll(".symbol-wrap").forEach(d=>{const l=d.dataset.symbol,i=m.has(l)||a;d.classList.toggle("label-above",i),d.classList.toggle("label-below",!i)})}function Le(s=[],a=[],m=!1){const d=document.getElementById("map-overlay");if(!d)return;d.innerHTML="";const l=(i,y)=>{const E=window.MAP_COORDS[i];if(!E)return;const f=document.createElement("div");f.className=`symbol-wrap ${y}`,f.dataset.symbol=i,f.style.left=E.left,f.style.top=`calc(${E.top} + var(--pin-y-nudge))`;const g=document.createElement("img");g.className="symbol-overlay",g.src=`img/${i}.png`,g.alt=i,f.appendChild(g);const w=document.createElement("div");w.className="map-label",w.textContent=(window.SYMBOL_NAME_MAP[i]||i).toUpperCase(),f.appendChild(w),d.appendChild(f)};s.forEach(i=>l(i,"truth")),a.forEach(i=>l(i,"lie")),W()}window.addEventListener("resize",W);window.addEventListener("orientationchange",W);window.showMapHighlights=Le;window.addEventListener("DOMContentLoaded",()=>{const s=()=>{const e=document.querySelector(".dial");if(!e)return;const t=e.getBoundingClientRect().width,o=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--truthlie-coef"))||.065,n=Math.max(10,Math.round(t*o))+"px",r=document.getElementById("label-left"),c=document.getElementById("label-right");r&&r.style.setProperty("font-size",n,"important"),c&&c.style.setProperty("font-size",n,"important")};requestAnimationFrame(s),window.addEventListener("resize",s);const a=5;function m(e){if(!e)return{x:50,y:50};if("x"in e&&"y"in e)return{x:+e.x,y:+e.y};const t=parseFloat(e.left),o=parseFloat(e.top),n=a/2;return{x:t+n,y:o+n}}function d(){const e=document.querySelectorAll(".symbol-overlay");e.forEach(t=>t.classList.remove("pulse")),document.body.offsetWidth,e.forEach(t=>t.classList.add("pulse"))}const l=()=>requestAnimationFrame(()=>requestAnimationFrame(d)),i=document.querySelectorAll(".dial-slot"),y=document.getElementById("symbolPopup"),E=document.getElementById("popupGrid"),f=document.getElementById("lockButton"),g=document.querySelector(".btn-reset"),w=document.getElementById("tooltip"),F=document.getElementById("tooltipCheckbox"),C=document.getElementById("symbolNamesCheckbox");let k="entry",I=[],P=[],A=[];localStorage.getItem("firstVisitDone")!=="true"&&(localStorage.setItem("tooltipVisible","true"),localStorage.setItem("showSymbolNames","true"),localStorage.setItem("firstVisitDone","true"));const Y=(localStorage.getItem("tooltipVisible")??"true")==="true";F.checked=Y,w.classList.toggle("hidden",!Y),F.addEventListener("change",()=>{const e=F.checked;w.classList.toggle("hidden",!e),localStorage.setItem("tooltipVisible",e?"true":"false")});const S=e=>{w&&(w.textContent=e)},K=(localStorage.getItem("showSymbolNames")??"true")==="true";C.checked=K;function B(e){document.querySelectorAll(".dial-slot .symbol-name, .map-label").forEach(t=>{t.style.display=e?"block":"none"})}B(K),C.addEventListener("change",()=>{const e=C.checked;localStorage.setItem("showSymbolNames",e?"true":"false"),B(e)});const Z=e=>[1,2,3].map(t=>document.querySelector(`.dial-slot.${e}${t}`)),L=e=>Z(e).map(t=>t?.dataset.symbol||null),ce=()=>L("left").every(Boolean)&&L("right").every(Boolean);function de(e){const t=(e.dataset.symbol||"").toUpperCase();let o=e.querySelector(".symbol-name");o||(o=document.createElement("div"),o.className="symbol-name",e.appendChild(o)),o.textContent=t,o.style.display=C.checked?"block":"none"}const H=(e,t)=>{e.dataset.symbol=t||"",e.style.backgroundImage=t?`url('img/${t}.png')`:"",de(e)};function J(e,t,o){const n=[...new Set(Ee(e,t,o))],r=new Set(e.filter(Boolean));return n.filter(c=>!r.has(c))}function ue(e,t){const o=L(e);return o[t]=null,J(o,e,t)}function Q(e,t){const o=L(e);return J(o,e,t)}const X=()=>{if(k!=="entry")return;const e=L("left"),t=L("right"),o=e.every(Boolean),n=t.every(Boolean);if(o&&!n){const r=q(e);r&&(se("left",r),ee("left",r),S("Now complete the opposite side."))}else if(n&&!o){const r=q(t);r&&(se("right",r),ee("right",r),S("Now complete the opposite side."))}};function ee(e,t){const o=document.getElementById("label-left"),n=document.getElementById("label-right"),r=(c,h)=>{c&&(c.textContent=h?h.toUpperCase():"",c.className=h==="truth"?"truth-label":h==="lie"?"lie-label":"")};e==="left"?(r(o,t),n&&r(n,"")):(r(n,t),o&&r(o,"")),s()}const me=()=>{if(k!=="entry")return;let e=!0;for(;e;)e=!1,["left","right"].forEach(t=>{Z(t).forEach((o,n)=>{if(!o||o.dataset.symbol)return;const r=Q(t,n);r.length===1&&(H(o,r[0]),e=!0,X())})});z()},pe=window.MAP_COORDS||{},fe=window.SYMBOL_NAME_MAP||{};window.showMapHighlights=(e,t,o=!0)=>{const n=document.getElementById("map-overlay");if(!n)return;n.innerHTML="",[...e.map(c=>({sym:c,type:"truth"})),...t.map(c=>({sym:c,type:"lie"}))].forEach(({sym:c,type:h})=>{const b=pe[c];if(!b)return;const u=m(b),p=document.createElement("div");p.className=`symbol-wrap ${h}`,p.style.left=`${u.x}%`,p.style.top=`${u.y}%`,p.style.transform="translate(-50%, -50%)";const v=document.createElement("img");v.className="symbol-overlay pulse",v.src=`img/${c}.png`,v.alt=c,p.appendChild(v);const R=u.y>=88;p.classList.add(R?"label-above":"label-below");const M=document.createElement("div");M.className="map-label",M.textContent=o?fe[c]||c.toUpperCase():"",p.appendChild(M),n.appendChild(p)}),B(C.checked),l()};const N=document.createElement("div");N.className="rotate-prompt",N.textContent="Rotate device to view map",document.body.appendChild(N);const j=e=>N.classList.toggle("show",!!e);function O(){const e=document.querySelector(".map-container"),t=document.querySelector(".map-img"),o=document.getElementById("map-overlay");if(!e||!t||!o)return;const n=window.visualViewport,r=n?n.width:window.innerWidth,c=n?n.height:window.innerHeight,h=n?n.offsetLeft:0,b=n?n.offsetTop:0,u=t.naturalWidth&&t.naturalHeight?t.naturalWidth/t.naturalHeight:1920/1080;let p=r,v=p/u;v>c&&(v=c,p=v*u);const R=h+(r-p)/2,M=b+(c-v)/2;Object.assign(t.style,{width:`${p}px`,height:`${v}px`,left:`${R}px`,top:`${M}px`}),Object.assign(o.style,{width:`${p}px`,height:`${v}px`,left:`${R}px`,top:`${M}px`}),l()}async function he(){try{document.documentElement.requestFullscreen&&!document.fullscreenElement&&await document.documentElement.requestFullscreen(),screen.orientation&&screen.orientation.lock&&await screen.orientation.lock("landscape")}catch{}}async function ye(){if(window.innerWidth>900)return;document.body.classList.add("map-only");const e=document.querySelector(".map-img");e?e.complete?O():e.addEventListener("load",O,{once:!0}):O(),await he(),j(window.matchMedia("(orientation: portrait)").matches),l()}function ge(){document.body.classList.remove("map-only"),j(!1),document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen().catch(()=>{})}const x=()=>{document.body.classList.contains("map-only")&&(O(),l())};if(window.addEventListener("resize",x),window.addEventListener("orientationchange",()=>{x(),document.body.classList.contains("map-only")&&j(window.matchMedia("(orientation: portrait)").matches)}),window.addEventListener("load",x),window.visualViewport){const e=window.visualViewport;e.addEventListener("resize",x),e.addEventListener("scroll",x)}function we(e,t){k="illumination",f.classList.add("glow-phase"),y.style.display="none",S("Now select the symbols that are illuminated in-game");const o=document.getElementById("label-left"),n=document.getElementById("label-right");o&&n&&(o.textContent=e.toUpperCase(),n.textContent=t.toUpperCase(),o.className=e==="truth"?"truth-label":"lie-label",n.className=t==="truth"?"truth-label":"lie-label",s());const r=L("left"),c=L("right");P=e==="truth"?r:c,A=e==="truth"?c:r,I=[],[...P,...A].forEach(h=>{const b=[...i].find(u=>u.dataset.symbol===h);b&&I.push(b)})}function te(){if(k!=="illumination")return;const e=[...document.querySelectorAll(".dial-slot.glow")].map(n=>n.dataset.symbol),t=P.filter(n=>e.includes(n)),o=A.filter(n=>!e.includes(n));f.classList.remove("glow-phase"),k="final",S("Follow the map to interact with the marked symbols. Tap Reset to start again."),window.showMapHighlights(t,o),ye()}function oe(){document.querySelectorAll(".dial-slot").forEach(t=>{t.dataset.symbol="",t.style.backgroundImage="",t.classList.remove("glow");const o=t.querySelector(".symbol-name");o&&(o.textContent="")}),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",f.classList.remove("glow-phase"),y.style.display="none",k="entry",I=[],P=[],A=[],ae(),S("Enter the symbols you see in-game");const e=document.getElementById("map-overlay");e&&(e.innerHTML=""),B(C.checked),ge(),s()}window.handleLock=te,window.resetDial=oe,f.addEventListener("click",te),g.addEventListener("click",oe);function z(){if(!ce())return;const e=L("left"),t=L("right"),o=q(e),n=q(t);!e.some(h=>t.includes(h))&&(o==="truth"&&n==="lie"||o==="lie"&&n==="truth")?we(o,n):S("Both sides must be opposite types with no duplicate symbols across the dial.")}[...i].forEach(e=>{e.addEventListener("click",()=>{if(k==="final")return;const t=Array.from(e.classList),o=t.find(u=>/^left[123]$/.test(u)),n=t.find(u=>/^right[123]$/.test(u)),r=o?"left":n?"right":null,c=o?+o.replace("left","")-1:n?+n.replace("right","")-1:null;if(!r||c==null)return;if(k==="illumination"){I.includes(e)&&e.classList.toggle("glow");return}const h=!!e.dataset.symbol;let b=h?ue(r,c):Q(r,c);if(h&&b.length===0&&e.dataset.symbol&&(b=[e.dataset.symbol]),E.innerHTML="",h){const u=document.createElement("div");u.textContent="Clear",Object.assign(u.style,{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",background:"#333",border:"1px solid #777",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"700"}),u.addEventListener("click",()=>{H(e,""),y.style.display="none",ae(),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",S("Enter the symbols you see in-game"),s(),z()}),E.appendChild(u)}if(b.length===0){const u=document.createElement("div");u.textContent="No valid symbols",E.appendChild(u)}else b.forEach(u=>{const p=document.createElement("img");p.src=`img/${u}.png`,p.alt=u,p.addEventListener("click",()=>{H(e,u),y.style.display="none",X(),z(),me()}),E.appendChild(p)});y.style.display="block"})}),document.addEventListener("click",e=>{!y.contains(e.target)&&![...i].includes(e.target)&&(y.style.display="none")})});
