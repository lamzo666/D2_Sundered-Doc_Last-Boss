(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))m(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&m(g)}).observe(document,{childList:!0,subtree:!0});function c(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function m(o){if(o.ep)return;o.ep=!0;const d=c(o);fetch(o.href,d)}})();const q=Object.freeze([["pyramid","drink","worm"],["pyramid","kill","worm"],["pyramid","stop","savathun"],["pyramid","give","darkness"],["guardian","worship","light"],["guardian","worship","traveller"],["guardian","kill","witness"],["traveller","give","guardian"],["traveller","give","light"],["hive","worship","darkness"],["hive","worship","worm"],["darkness","stop","savathun"]]),T=Object.freeze([["hive","kill","worm"],["hive","kill","light"],["hive","give","darkness"],["hive","stop","witness"],["traveller","kill","guardian"],["traveller","drink","worm"],["traveller","give","hive"],["traveller","stop","witness"],["pyramid","drink","guardian"],["pyramid","stop","witness"],["witness","drink","light"],["witness","kill","pyramid"],["guardian","worship","witness"],["guardian","kill","traveller"],["savathun","drink","darkness"],["savathun","stop","darkness"],["light","stop","savathun"]]);let V=null,H=null;const te=(i,s)=>i.length===s.length&&i.every((c,m)=>c===s[m]),ye=i=>q.some(s=>te(s,i))?"truth":T.some(s=>te(s,i))?"lie":null,oe=i=>[1,2,3].map(s=>document.querySelector(`.dial-slot.${i}${s}`)?.dataset.symbol||null),j=(i,s)=>i.filter(c=>c.every((m,o)=>!s[o]||s[o]===m)),we=(i,s)=>{const c=new Set(i);return!s.some(m=>c.has(m))};function z(i){return V?V===i?H==="truth"?[q]:[T]:H==="truth"?[T]:[q]:[q,T]}function ne(i,s){const c=[...new Set(z("left").flatMap(o=>j(o,i).map(d=>d.join("|"))))].map(o=>o.split("|")),m=[...new Set(z("right").flatMap(o=>j(o,s).map(d=>d.join("|"))))].map(o=>o.split("|"));if(!c.length||!m.length)return!1;for(const o of c)for(const d of m)if(we(o,d))return!0;return!1}function be(i,s,c){if(c<0||c>2)return[];const m=s==="left"?[...i]:oe("left"),o=s==="right"?[...i]:oe("right"),d=j(z(s).flat(),s==="left"?m:o),g=[...new Set(d.map(h=>h[c]))],v=new Set(i.filter(Boolean)),y=[];for(const h of g)if(!v.has(h))if(s==="left"){const w=[...m];w[c]=h,ne(w,o)&&y.push(h)}else{const w=[...o];w[c]=h,ne(m,w)&&y.push(h)}return y}function R(i){return ye(i)}function le(i,s){V=i,H=s}function ie(){V=null,H=null}window.MAP_COORDS={stop:{top:"22.31%",left:"38.64%"},kill:{top:"70.14%",left:"65.96%"},darkness:{top:"39.91%",left:"80.93%"},drink:{top:"1.74%",left:"56.29%"},give:{top:"22.31%",left:"53.32%"},guardian:{top:"45.96%",left:"19.49%"},hive:{top:"29.77%",left:"19.53%"},light:{top:"59.68%",left:"72.98%"},pyramid:{top:"62.75%",left:"2.15%"},savathun:{top:"5.32%",left:"92.50%"},traveller:{top:"87.52%",left:"19.53%"},witness:{top:"30.20%",left:"2.00%"},worm:{top:"7.16%",left:"75.20%"},worship:{top:"70.42%",left:"31.45%"}};window.SYMBOL_NAME_MAP={stop:"STOP",kill:"KILL",darkness:"DARKNESS",drink:"DRINK",give:"GIVE",guardian:"GUARDIAN",hive:"HIVE",light:"LIGHT",pyramid:"PYRAMID",savathun:"SAVATHUN",traveller:"TRAVELLER",witness:"WITNESS",worm:"WORM",worship:"WORSHIP"};const $={defaultDesktop:"below",defaultMobile:"below",desktopAbove:["hive","drink","witness","pyramid","worm"],mobileAbove:["hive","drink","witness","pyramid","worm"]};function se(){return window.matchMedia("(max-width: 640px)").matches}function G(){const i=new Set(se()?$.mobileAbove:$.desktopAbove),s=(se()?$.defaultMobile:$.defaultDesktop)==="above";document.querySelectorAll(".symbol-wrap").forEach(c=>{const m=c.dataset.symbol,o=i.has(m)||s;c.classList.toggle("label-above",o),c.classList.toggle("label-below",!o)})}function ve(i=[],s=[]){const c=document.getElementById("map-overlay");if(!c)return;c.innerHTML="";const m=(o,d)=>{const g=symbolPositions[o];if(!g)return;const v=document.createElement("div");v.className=`symbol-wrap ${d}`,v.dataset.symbol=o,v.style.top=g.top,v.style.left=g.left;const y=document.createElement("img");y.className="symbol-overlay",y.src=`img/${o}.png`,y.alt=o,v.appendChild(y);const h=document.createElement("div");h.className="map-label",h.textContent=o.toUpperCase(),v.appendChild(h),c.appendChild(v)};i.forEach(o=>m(o,"truth")),s.forEach(o=>m(o,"lie")),G()}window.addEventListener("resize",G);window.addEventListener("orientationchange",G);window.showMapHighlights=ve;window.addEventListener("DOMContentLoaded",()=>{const i=()=>{const e=document.querySelector(".dial");if(!e)return;const t=e.getBoundingClientRect().width,n=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--truthlie-coef"))||.085,l=Math.max(10,Math.round(t*n))+"px",a=document.getElementById("label-left"),r=document.getElementById("label-right");a&&a.style.setProperty("font-size",l,"important"),r&&r.style.setProperty("font-size",l,"important")};requestAnimationFrame(i),window.addEventListener("resize",i);const s=5;function c(e){if(!e)return{x:50,y:50};if("x"in e&&"y"in e)return{x:+e.x,y:+e.y};const t=parseFloat(e.left),n=parseFloat(e.top),l=s/2;return{x:t+l,y:n+l}}const m=document.querySelectorAll(".dial-slot"),o=document.getElementById("symbolPopup"),d=document.getElementById("popupGrid"),g=document.getElementById("lockButton"),v=document.querySelector(".btn-reset"),y=document.getElementById("tooltip"),h=document.getElementById("tooltipCheckbox"),w=document.getElementById("symbolNamesCheckbox");let k="entry",I=[],M=[],B=[];localStorage.getItem("firstVisitDone")!=="true"&&(localStorage.setItem("tooltipVisible","true"),localStorage.setItem("showSymbolNames","true"),localStorage.setItem("firstVisitDone","true"));const U=(localStorage.getItem("tooltipVisible")??"true")==="true";h.checked=U,y.classList.toggle("hidden",!U),h.addEventListener("change",()=>{const e=h.checked;y.classList.toggle("hidden",!e),localStorage.setItem("tooltipVisible",e?"true":"false")});const S=e=>{y&&(y.textContent=e)},W=(localStorage.getItem("showSymbolNames")??"true")==="true";w.checked=W;function N(e){document.querySelectorAll(".dial-slot .symbol-name, .map-label").forEach(t=>{t.style.display=e?"block":"none"})}N(W),w.addEventListener("change",()=>{const e=w.checked;localStorage.setItem("showSymbolNames",e?"true":"false"),N(e)});const K=e=>[1,2,3].map(t=>document.querySelector(`.dial-slot.${e}${t}`)),L=e=>K(e).map(t=>t?.dataset.symbol||null),ae=()=>L("left").every(Boolean)&&L("right").every(Boolean);function re(e){const t=(e.dataset.symbol||"").toUpperCase();let n=e.querySelector(".symbol-name");n||(n=document.createElement("div"),n.className="symbol-name",e.appendChild(n)),n.textContent=t,n.style.display=w.checked?"block":"none"}const D=(e,t)=>{e.dataset.symbol=t||"",e.style.backgroundImage=t?`url('img/${t}.png')`:"",re(e)};function Y(e,t,n){const l=[...new Set(be(e,t,n))],a=new Set(e.filter(Boolean));return l.filter(r=>!a.has(r))}function ce(e,t){const n=L(e);return n[t]=null,Y(n,e,t)}function Z(e,t){const n=L(e);return Y(n,e,t)}const J=()=>{if(k!=="entry")return;const e=L("left"),t=L("right"),n=e.every(Boolean),l=t.every(Boolean);if(n&&!l){const a=R(e);a&&(le("left",a),Q("left",a),S("Now complete the opposite side."))}else if(l&&!n){const a=R(t);a&&(le("right",a),Q("right",a),S("Now complete the opposite side."))}};function Q(e,t){const n=document.getElementById("label-left"),l=document.getElementById("label-right"),a=(r,f)=>{r&&(r.textContent=f?f.toUpperCase():"",r.className=f==="truth"?"truth-label":f==="lie"?"lie-label":"")};e==="left"?(a(n,t),l&&a(l,"")):(a(l,t),n&&a(n,"")),i()}const de=()=>{if(k!=="entry")return;let e=!0;for(;e;)e=!1,["left","right"].forEach(t=>{K(t).forEach((n,l)=>{if(!n||n.dataset.symbol)return;const a=Z(t,l);a.length===1&&(D(n,a[0]),e=!0,J())})});_()},me=window.MAP_COORDS||{},ue=window.SYMBOL_NAME_MAP||{};window.showMapHighlights=(e,t,n=!0)=>{const l=document.getElementById("map-overlay");if(!l)return;l.innerHTML="",[...e.map(r=>({sym:r,type:"truth"})),...t.map(r=>({sym:r,type:"lie"}))].forEach(({sym:r,type:f})=>{const b=me[r];if(!b)return;const u=c(b),p=document.createElement("div");p.className=`symbol-wrap ${f}`,p.style.left=`${u.x}%`,p.style.top=`${u.y}%`,p.style.transform="translate(-50%, -50%)";const E=document.createElement("img");E.className="symbol-overlay",E.src=`img/${r}.png`,E.alt=r,p.appendChild(E);const O=u.y>=88;p.classList.add(O?"label-above":"label-below");const C=document.createElement("div");C.className="map-label",C.textContent=n?ue[r]||r.toUpperCase():"",p.appendChild(C),l.appendChild(p)}),N(w.checked)},[...m].forEach(e=>{e.addEventListener("click",()=>{if(k==="final")return;const t=Array.from(e.classList),n=t.find(u=>/^left[123]$/.test(u)),l=t.find(u=>/^right[123]$/.test(u)),a=n?"left":l?"right":null,r=n?+n.replace("left","")-1:l?+l.replace("right","")-1:null;if(!a||r==null)return;if(k==="illumination"){I.includes(e)&&e.classList.toggle("glow");return}const f=!!e.dataset.symbol;let b=f?ce(a,r):Z(a,r);if(f&&b.length===0&&e.dataset.symbol&&(b=[e.dataset.symbol]),d.innerHTML="",f){const u=document.createElement("div");u.textContent="Clear",Object.assign(u.style,{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",background:"#333",border:"1px solid #777",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"700"}),u.addEventListener("click",()=>{D(e,""),o.style.display="none",ie(),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",S("Enter the symbols you see in-game"),i(),_()}),d.appendChild(u)}if(b.length===0){const u=document.createElement("div");u.textContent="No valid symbols",d.appendChild(u)}else b.forEach(u=>{const p=document.createElement("img");p.src=`img/${u}.png`,p.alt=u,p.addEventListener("click",()=>{D(e,u),o.style.display="none",J(),_(),de()}),d.appendChild(p)});o.style.display="block"})}),document.addEventListener("click",e=>{!o.contains(e.target)&&![...m].includes(e.target)&&(o.style.display="none")});const x=document.createElement("div");x.id="rotatePrompt",x.className="rotate-prompt",x.textContent="Rotate device to view map",document.body.appendChild(x);function F(e){x.classList.toggle("show",!!e)}function P(){const e=document.querySelector(".map-container"),t=document.querySelector(".map-img"),n=document.getElementById("map-overlay");if(!e||!t||!n)return;const l=window.visualViewport,a=l?l.width:window.innerWidth,r=l?l.height:window.innerHeight,f=l?l.offsetLeft:0,b=l?l.offsetTop:0,u=t.naturalWidth&&t.naturalHeight?t.naturalWidth/t.naturalHeight:1920/1080;let p=a,E=p/u;E>r&&(E=r,p=E*u);const O=f+(a-p)/2,C=b+(r-E)/2;Object.assign(t.style,{width:`${p}px`,height:`${E}px`,left:`${O}px`,top:`${C}px`}),Object.assign(n.style,{width:`${p}px`,height:`${E}px`,left:`${O}px`,top:`${C}px`})}async function pe(){try{document.documentElement.requestFullscreen&&!document.fullscreenElement&&await document.documentElement.requestFullscreen(),screen.orientation&&screen.orientation.lock&&await screen.orientation.lock("landscape")}catch{}}async function fe(){if(!(window.innerWidth<=900))return;document.body.classList.add("map-only");const t=document.querySelector(".map-img");t?t.complete?P():t.addEventListener("load",P,{once:!0}):P(),await pe(),F(window.matchMedia("(orientation: portrait)").matches)}function he(){document.body.classList.remove("map-only"),F(!1),document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen().catch(()=>{})}const A=()=>{document.body.classList.contains("map-only")&&P()};if(window.addEventListener("resize",A),window.addEventListener("orientationchange",()=>{A(),document.body.classList.contains("map-only")&&F(window.matchMedia("(orientation: portrait)").matches)}),window.visualViewport){const e=window.visualViewport;e.addEventListener("resize",A),e.addEventListener("scroll",A)}function ge(e,t){k="illumination",g.classList.add("glow-phase"),o.style.display="none",S("Now select the symbols that are illuminated in-game");const n=document.getElementById("label-left"),l=document.getElementById("label-right");n&&l&&(n.textContent=e.toUpperCase(),l.textContent=t.toUpperCase(),n.className=e==="truth"?"truth-label":"lie-label",l.className=t==="truth"?"truth-label":"lie-label",i());const a=L("left"),r=L("right");M=e==="truth"?a:r,B=e==="truth"?r:a,I=[],[...M,...B].forEach(f=>{const b=[...m].find(u=>u.dataset.symbol===f);b&&I.push(b)})}function X(){if(k!=="illumination")return;const e=[...document.querySelectorAll(".dial-slot.glow")].map(l=>l.dataset.symbol),t=M.filter(l=>e.includes(l)),n=B.filter(l=>!e.includes(l));g.classList.remove("glow-phase"),k="final",S("Follow the map to interact with the marked symbols. Tap Reset to start again."),window.showMapHighlights(t,n),fe()}function ee(){document.querySelectorAll(".dial-slot").forEach(t=>{t.dataset.symbol="",t.style.backgroundImage="",t.classList.remove("glow");const n=t.querySelector(".symbol-name");n&&(n.textContent="")}),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",g.classList.remove("glow-phase"),o.style.display="none",k="entry",I=[],M=[],B=[],ie(),S("Enter the symbols you see in-game");const e=document.getElementById("map-overlay");e&&(e.innerHTML=""),N(w.checked),he(),i()}window.handleLock=X,window.resetDial=ee,g.addEventListener("click",X),v.addEventListener("click",ee);function _(){if(!ae())return;const e=L("left"),t=L("right"),n=R(e),l=R(t);!e.some(f=>t.includes(f))&&(n==="truth"&&l==="lie"||n==="lie"&&l==="truth")?ge(n,l):S("Both sides must be opposite types with no duplicate symbols across the dial.")}});
