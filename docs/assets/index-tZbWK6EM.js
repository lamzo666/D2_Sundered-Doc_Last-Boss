(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const f of d.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function a(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function c(o){if(o.ep)return;o.ep=!0;const d=a(o);fetch(o.href,d)}})();const P=Object.freeze([["pyramid","drink","worm"],["pyramid","kill","worm"],["pyramid","stop","savathun"],["pyramid","give","darkness"],["guardian","worship","light"],["guardian","worship","traveller"],["guardian","kill","witness"],["traveller","give","guardian"],["traveller","give","light"],["hive","worship","darkness"],["hive","worship","worm"],["darkness","stop","savathun"]]),q=Object.freeze([["hive","kill","worm"],["hive","kill","light"],["hive","give","darkness"],["hive","stop","witness"],["traveller","kill","guardian"],["traveller","drink","worm"],["traveller","give","hive"],["traveller","stop","witness"],["pyramid","drink","guardian"],["pyramid","stop","witness"],["witness","drink","light"],["witness","kill","pyramid"],["guardian","worship","witness"],["guardian","kill","traveller"],["savathun","drink","darkness"],["savathun","stop","darkness"],["light","stop","savathun"]]);let O=null,$=null;const Z=(i,s)=>i.length===s.length&&i.every((a,c)=>a===s[c]),pe=i=>P.some(s=>Z(s,i))?"truth":q.some(s=>Z(s,i))?"lie":null,ee=i=>[1,2,3].map(s=>document.querySelector(`.dial-slot.${i}${s}`)?.dataset.symbol||null),j=(i,s)=>i.filter(a=>a.every((c,o)=>!s[o]||s[o]===c)),fe=(i,s)=>{const a=new Set(i);return!s.some(c=>a.has(c))};function T(i){return O?O===i?$==="truth"?[P]:[q]:$==="truth"?[q]:[P]:[P,q]}function te(i,s){const a=[...new Set(T("left").flatMap(o=>j(o,i).map(d=>d.join("|"))))].map(o=>o.split("|")),c=[...new Set(T("right").flatMap(o=>j(o,s).map(d=>d.join("|"))))].map(o=>o.split("|"));if(!a.length||!c.length)return!1;for(const o of a)for(const d of c)if(fe(o,d))return!0;return!1}function he(i,s,a){if(a<0||a>2)return[];const c=s==="left"?[...i]:ee("left"),o=s==="right"?[...i]:ee("right"),d=j(T(s).flat(),s==="left"?c:o),f=[...new Set(d.map(u=>u[a]))],y=new Set(i.filter(Boolean)),h=[];for(const u of f)if(!y.has(u))if(s==="left"){const w=[...c];w[a]=u,te(w,o)&&h.push(u)}else{const w=[...o];w[a]=u,te(c,w)&&h.push(u)}return h}function M(i){return pe(i)}function oe(i,s){O=i,$=s}function ne(){O=null,$=null}const ge={stop:{top:"22.31%",left:"38.64%"},kill:{top:"70.14%",left:"65.96%"},darkness:{top:"39.91%",left:"80.93%"},drink:{top:"1.74%",left:"56.29%"},give:{top:"22.31%",left:"53.32%"},guardian:{top:"45.96%",left:"19.49%"},hive:{top:"29.77%",left:"19.53%"},light:{top:"59.68%",left:"72.98%"},pyramid:{top:"62.75%",left:"2.15%"},savathun:{top:"5.32%",left:"92.50%"},traveller:{top:"87.52%",left:"19.53%"},witness:{top:"30.20%",left:"2.00%"},worm:{top:"7.16%",left:"75.20%"},worship:{top:"70.42%",left:"31.45%"}},N={defaultDesktop:"below",defaultMobile:"below",desktopAbove:["hive","drink","witness","pyramid","worm"],mobileAbove:["hive","drink","witness","pyramid","worm"]};function le(){return window.matchMedia("(max-width: 640px)").matches}function z(){const i=new Set(le()?N.mobileAbove:N.desktopAbove),s=(le()?N.defaultMobile:N.defaultDesktop)==="above";document.querySelectorAll(".symbol-wrap").forEach(a=>{const c=a.dataset.symbol,o=i.has(c)||s;a.classList.toggle("label-above",o),a.classList.toggle("label-below",!o)})}function ye(i=[],s=[]){const a=document.getElementById("map-overlay");if(!a)return;a.innerHTML="";const c=(o,d)=>{const f=ge[o];if(!f)return;const y=document.createElement("div");y.className=`symbol-wrap ${d}`,y.dataset.symbol=o,y.style.top=f.top,y.style.left=f.left;const h=document.createElement("img");h.className="symbol-overlay",h.src=`img/${o}.png`,h.alt=o,y.appendChild(h);const u=document.createElement("div");u.className="map-label",u.textContent=o.toUpperCase(),y.appendChild(u),a.appendChild(y)};i.forEach(o=>c(o,"truth")),s.forEach(o=>c(o,"lie")),z()}window.addEventListener("resize",z);window.addEventListener("orientationchange",z);window.showMapHighlights=ye;window.addEventListener("DOMContentLoaded",()=>{const i=()=>{const e=document.querySelector(".dial");if(!e)return;const t=e.getBoundingClientRect().width,n=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--truthlie-coef"))||.085,l=Math.max(10,Math.round(t*n))+"px",r=document.getElementById("label-left"),m=document.getElementById("label-right");r&&r.style.setProperty("font-size",l,"important"),m&&m.style.setProperty("font-size",l,"important")};requestAnimationFrame(i),window.addEventListener("resize",i);const s=document.querySelectorAll(".dial-slot"),a=document.getElementById("symbolPopup"),c=document.getElementById("popupGrid"),o=document.getElementById("lockButton"),d=document.querySelector(".btn-reset"),f=document.getElementById("tooltip"),y=document.getElementById("tooltipCheckbox"),h=document.getElementById("symbolNamesCheckbox");let u="entry",w=[],x=[],C=[];localStorage.getItem("firstVisitDone")!=="true"&&(localStorage.setItem("tooltipVisible","true"),localStorage.setItem("showSymbolNames","true"),localStorage.setItem("firstVisitDone","true"));const H=(localStorage.getItem("tooltipVisible")??"true")==="true";y.checked=H,f.classList.toggle("hidden",!H),y.addEventListener("change",()=>{const e=y.checked;f.classList.toggle("hidden",!e),localStorage.setItem("tooltipVisible",e?"true":"false")});const L=e=>{f&&(f.textContent=e)},D=(localStorage.getItem("showSymbolNames")??"true")==="true";h.checked=D;function A(e){document.querySelectorAll(".dial-slot .symbol-name, .map-label").forEach(t=>{t.style.display=e?"block":"none"})}A(D),h.addEventListener("change",()=>{const e=h.checked;localStorage.setItem("showSymbolNames",e?"true":"false"),A(e)});const G=e=>[1,2,3].map(t=>document.querySelector(`.dial-slot.${e}${t}`)),b=e=>G(e).map(t=>t?.dataset.symbol||null),ie=()=>b("left").every(Boolean)&&b("right").every(Boolean);function se(e){const t=(e.dataset.symbol||"").toUpperCase();let n=e.querySelector(".symbol-name");n||(n=document.createElement("div"),n.className="symbol-name",e.appendChild(n)),n.textContent=t,n.style.display=h.checked?"block":"none"}const R=(e,t)=>{e.dataset.symbol=t||"",e.style.backgroundImage=t?`url('img/${t}.png')`:"",se(e)};function U(e,t,n){const l=[...new Set(he(e,t,n))],r=new Set(e.filter(Boolean));return l.filter(m=>!r.has(m))}function ae(e,t){const n=b(e);return n[t]=null,U(n,e,t)}function W(e,t){const n=b(e);return U(n,e,t)}const _=()=>{if(u!=="entry")return;const e=b("left"),t=b("right"),n=e.every(Boolean),l=t.every(Boolean);if(n&&!l){const r=M(e);r&&(oe("left",r),K("left",r),L("Now complete the opposite side."))}else if(l&&!n){const r=M(t);r&&(oe("right",r),K("right",r),L("Now complete the opposite side."))}};function K(e,t){const n=document.getElementById("label-left"),l=document.getElementById("label-right"),r=(m,g)=>{m&&(m.textContent=g?g.toUpperCase():"",m.className=g==="truth"?"truth-label":g==="lie"?"lie-label":"")};e==="left"?(r(n,t),l&&r(l,"")):(r(l,t),n&&r(n,"")),i()}const re=()=>{if(u!=="entry")return;let e=!0;for(;e;)e=!1,["left","right"].forEach(t=>{G(t).forEach((n,l)=>{if(!n||n.dataset.symbol)return;const r=W(t,l);r.length===1&&(R(n,r[0]),e=!0,_())})});F()};[...s].forEach(e=>{e.addEventListener("click",()=>{if(u==="final")return;const t=Array.from(e.classList),n=t.find(p=>/^left[123]$/.test(p)),l=t.find(p=>/^right[123]$/.test(p)),r=n?"left":l?"right":null,m=n?+n.replace("left","")-1:l?+l.replace("right","")-1:null;if(!r||m==null)return;if(u==="illumination"){w.includes(e)&&e.classList.toggle("glow");return}const g=!!e.dataset.symbol;let E=g?ae(r,m):W(r,m);if(g&&E.length===0&&e.dataset.symbol&&(E=[e.dataset.symbol]),c.innerHTML="",g){const p=document.createElement("div");p.textContent="Clear",Object.assign(p.style,{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",background:"#333",border:"1px solid #777",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"700"}),p.addEventListener("click",()=>{R(e,""),a.style.display="none",ne(),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",L("Enter the symbols you see in-game"),i(),F()}),c.appendChild(p)}if(E.length===0){const p=document.createElement("div");p.textContent="No valid symbols",c.appendChild(p)}else E.forEach(p=>{const v=document.createElement("img");v.src=`img/${p}.png`,v.alt=p,v.addEventListener("click",()=>{R(e,p),a.style.display="none",_(),F(),re()}),c.appendChild(v)});a.style.display="block"})}),document.addEventListener("click",e=>{!a.contains(e.target)&&![...s].includes(e.target)&&(a.style.display="none")});const S=document.createElement("div");S.id="rotatePrompt",S.className="rotate-prompt",S.textContent="Rotate device to view map",document.body.appendChild(S);function V(e){S.classList.toggle("show",!!e)}function I(){const e=document.querySelector(".map-container"),t=document.querySelector(".map-img"),n=document.getElementById("map-overlay");if(!e||!t||!n)return;const l=window.visualViewport,r=l?l.width:window.innerWidth,m=l?l.height:window.innerHeight,g=l?l.offsetLeft:0,E=l?l.offsetTop:0,p=t.naturalWidth&&t.naturalHeight?t.naturalWidth/t.naturalHeight:1920/1080;let v=r,k=v/p;k>m&&(k=m,v=k*p);const X=g+(r-v)/2,Y=E+(m-k)/2;Object.assign(t.style,{width:`${v}px`,height:`${k}px`,left:`${X}px`,top:`${Y}px`}),Object.assign(n.style,{width:`${v}px`,height:`${k}px`,left:`${X}px`,top:`${Y}px`})}async function ce(){try{document.documentElement.requestFullscreen&&!document.fullscreenElement&&await document.documentElement.requestFullscreen(),screen.orientation&&screen.orientation.lock&&await screen.orientation.lock("landscape")}catch{}}async function de(){if(!(window.innerWidth<=900))return;document.body.classList.add("map-only");const t=document.querySelector(".map-img");t?t.complete?I():t.addEventListener("load",I,{once:!0}):I(),await ce(),V(window.matchMedia("(orientation: portrait)").matches)}function ue(){document.body.classList.remove("map-only"),V(!1),document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen().catch(()=>{})}const B=()=>{document.body.classList.contains("map-only")&&I()};if(window.addEventListener("resize",B),window.addEventListener("orientationchange",()=>{B(),document.body.classList.contains("map-only")&&V(window.matchMedia("(orientation: portrait)").matches)}),window.visualViewport){const e=window.visualViewport;e.addEventListener("resize",B),e.addEventListener("scroll",B)}function me(e,t){u="illumination",o.classList.add("glow-phase"),a.style.display="none",L("Now select the symbols that are illuminated in-game");const n=document.getElementById("label-left"),l=document.getElementById("label-right");n&&l&&(n.textContent=e.toUpperCase(),l.textContent=t.toUpperCase(),n.className=e==="truth"?"truth-label":"lie-label",l.className=t==="truth"?"truth-label":"lie-label",i());const r=b("left"),m=b("right");x=e==="truth"?r:m,C=e==="truth"?m:r,w=[],[...x,...C].forEach(g=>{const E=[...s].find(p=>p.dataset.symbol===g);E&&w.push(E)})}function J(){if(u!=="illumination")return;const e=[...document.querySelectorAll(".dial-slot.glow")].map(l=>l.dataset.symbol),t=x.filter(l=>e.includes(l)),n=C.filter(l=>!e.includes(l));o.classList.remove("glow-phase"),u="final",L("Follow the map to interact with the marked symbols. Tap Reset to start again."),window.showMapHighlights(t,n),de()}function Q(){document.querySelectorAll(".dial-slot").forEach(t=>{t.dataset.symbol="",t.style.backgroundImage="",t.classList.remove("glow");const n=t.querySelector(".symbol-name");n&&(n.textContent="")}),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",o.classList.remove("glow-phase"),a.style.display="none",u="entry",w=[],x=[],C=[],ne(),L("Enter the symbols you see in-game");const e=document.getElementById("map-overlay");e&&(e.innerHTML=""),A(h.checked),ue(),i()}window.handleLock=J,window.resetDial=Q,o.addEventListener("click",J),d.addEventListener("click",Q);function F(){if(!ie())return;const e=b("left"),t=b("right"),n=M(e),l=M(t);!e.some(g=>t.includes(g))&&(n==="truth"&&l==="lie"||n==="lie"&&l==="truth")?me(n,l):L("Both sides must be opposite types with no duplicate symbols across the dial.")}});
