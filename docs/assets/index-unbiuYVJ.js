(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))m(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&m(g)}).observe(document,{childList:!0,subtree:!0});function a(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function m(o){if(o.ep)return;o.ep=!0;const u=a(o);fetch(o.href,u)}})();const O=Object.freeze([["pyramid","drink","worm"],["pyramid","kill","worm"],["pyramid","stop","savathun"],["pyramid","give","darkness"],["guardian","worship","light"],["guardian","worship","traveller"],["guardian","kill","witness"],["traveller","give","guardian"],["traveller","give","light"],["hive","worship","darkness"],["hive","worship","worm"],["darkness","stop","savathun"]]),R=Object.freeze([["hive","kill","worm"],["hive","kill","light"],["hive","give","darkness"],["hive","stop","witness"],["traveller","kill","guardian"],["traveller","drink","worm"],["traveller","give","hive"],["traveller","stop","witness"],["pyramid","drink","guardian"],["pyramid","stop","witness"],["witness","drink","light"],["witness","kill","pyramid"],["guardian","worship","witness"],["guardian","kill","traveller"],["savathun","drink","darkness"],["savathun","stop","darkness"],["light","stop","savathun"]]);let $=null,q=null;const Z=(i,s)=>i.length===s.length&&i.every((a,m)=>a===s[m]),fe=i=>O.some(s=>Z(s,i))?"truth":R.some(s=>Z(s,i))?"lie":null,ee=i=>[1,2,3].map(s=>document.querySelector(`.dial-slot.${i}${s}`)?.dataset.symbol||null),D=(i,s)=>i.filter(a=>a.every((m,o)=>!s[o]||s[o]===m)),ye=(i,s)=>{const a=new Set(i);return!s.some(m=>a.has(m))};function F(i){return $?$===i?q==="truth"?[O]:[R]:q==="truth"?[R]:[O]:[O,R]}function te(i,s){const a=[...new Set(F("left").flatMap(o=>D(o,i).map(u=>u.join("|"))))].map(o=>o.split("|")),m=[...new Set(F("right").flatMap(o=>D(o,s).map(u=>u.join("|"))))].map(o=>o.split("|"));if(!a.length||!m.length)return!1;for(const o of a)for(const u of m)if(ye(o,u))return!0;return!1}function ge(i,s,a){if(a<0||a>2)return[];const m=s==="left"?[...i]:ee("left"),o=s==="right"?[...i]:ee("right"),u=D(F(s).flat(),s==="left"?m:o),g=[...new Set(u.map(p=>p[a]))],b=new Set(i.filter(Boolean)),f=[];for(const p of g)if(!b.has(p))if(s==="left"){const v=[...m];v[a]=p,te(v,o)&&f.push(p)}else{const v=[...o];v[a]=p,te(m,v)&&f.push(p)}return f}function A(i){return fe(i)}function oe(i,s){$=i,q=s}function ne(){$=null,q=null}window.MAP_COORDS={stop:{x:38.64,y:22.31},kill:{x:65.96,y:70.14},darkness:{x:80.93,y:39.91},drink:{x:56.29,y:1.74},give:{x:53.32,y:22.31},guardian:{x:19.49,y:45.96},hive:{x:19.53,y:29.77},light:{x:72.98,y:59.68},pyramid:{x:2.15,y:62.75},savathun:{x:92.5,y:5.32},traveller:{x:19.53,y:87.52},witness:{x:2,y:30.2},worm:{x:75.2,y:7.16},worship:{x:31.45,y:70.42}};window.SYMBOL_NAME_MAP={stop:"STOP",kill:"KILL",darkness:"DARKNESS",drink:"DRINK",give:"GIVE",guardian:"GUARDIAN",hive:"HIVE",light:"LIGHT",pyramid:"PYRAMID",savathun:"SAVATHUN",traveller:"TRAVELLER",witness:"WITNESS",worm:"WORM",worship:"WORSHIP"};const P={defaultDesktop:"below",defaultMobile:"below",desktopAbove:["hive","drink","witness","pyramid","worm"],mobileAbove:["hive","drink","witness","pyramid","worm"]};function le(){return window.matchMedia("(max-width: 640px)").matches}function j(){const i=new Set(le()?P.mobileAbove:P.desktopAbove),s=(le()?P.defaultMobile:P.defaultDesktop)==="above";document.querySelectorAll(".symbol-wrap").forEach(a=>{const m=a.dataset.symbol,o=i.has(m)||s;a.classList.toggle("label-above",o),a.classList.toggle("label-below",!o)})}function we(i=[],s=[]){const a=document.getElementById("map-overlay");if(!a)return;a.innerHTML="";const m=(o,u)=>{const g=symbolPositions[o];if(!g)return;const b=document.createElement("div");b.className=`symbol-wrap ${u}`,b.dataset.symbol=o,b.style.top=g.top,b.style.left=g.left;const f=document.createElement("img");f.className="symbol-overlay",f.src=`img/${o}.png`,f.alt=o,b.appendChild(f);const p=document.createElement("div");p.className="map-label",p.textContent=o.toUpperCase(),b.appendChild(p),a.appendChild(b)};i.forEach(o=>m(o,"truth")),s.forEach(o=>m(o,"lie")),j()}window.addEventListener("resize",j);window.addEventListener("orientationchange",j);window.showMapHighlights=we;window.addEventListener("DOMContentLoaded",()=>{const i=()=>{const e=document.querySelector(".dial");if(!e)return;const t=e.getBoundingClientRect().width,n=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--truthlie-coef"))||.085,l=Math.max(10,Math.round(t*n))+"px",r=document.getElementById("label-left"),c=document.getElementById("label-right");r&&r.style.setProperty("font-size",l,"important"),c&&c.style.setProperty("font-size",l,"important")};requestAnimationFrame(i),window.addEventListener("resize",i);const s=document.querySelectorAll(".dial-slot"),a=document.getElementById("symbolPopup"),m=document.getElementById("popupGrid"),o=document.getElementById("lockButton"),u=document.querySelector(".btn-reset"),g=document.getElementById("tooltip"),b=document.getElementById("tooltipCheckbox"),f=document.getElementById("symbolNamesCheckbox");let p="entry",v=[],C=[],I=[];localStorage.getItem("firstVisitDone")!=="true"&&(localStorage.setItem("tooltipVisible","true"),localStorage.setItem("showSymbolNames","true"),localStorage.setItem("firstVisitDone","true"));const _=(localStorage.getItem("tooltipVisible")??"true")==="true";b.checked=_,g.classList.toggle("hidden",!_),b.addEventListener("change",()=>{const e=b.checked;g.classList.toggle("hidden",!e),localStorage.setItem("tooltipVisible",e?"true":"false")});const k=e=>{g&&(g.textContent=e)},z=(localStorage.getItem("showSymbolNames")??"true")==="true";f.checked=z;function M(e){document.querySelectorAll(".dial-slot .symbol-name, .map-label").forEach(t=>{t.style.display=e?"block":"none"})}M(z),f.addEventListener("change",()=>{const e=f.checked;localStorage.setItem("showSymbolNames",e?"true":"false"),M(e)});const G=e=>[1,2,3].map(t=>document.querySelector(`.dial-slot.${e}${t}`)),E=e=>G(e).map(t=>t?.dataset.symbol||null),ie=()=>E("left").every(Boolean)&&E("right").every(Boolean);function se(e){const t=(e.dataset.symbol||"").toUpperCase();let n=e.querySelector(".symbol-name");n||(n=document.createElement("div"),n.className="symbol-name",e.appendChild(n)),n.textContent=t,n.style.display=f.checked?"block":"none"}const V=(e,t)=>{e.dataset.symbol=t||"",e.style.backgroundImage=t?`url('img/${t}.png')`:"",se(e)};function U(e,t,n){const l=[...new Set(ge(e,t,n))],r=new Set(e.filter(Boolean));return l.filter(c=>!r.has(c))}function ae(e,t){const n=E(e);return n[t]=null,U(n,e,t)}function W(e,t){const n=E(e);return U(n,e,t)}const K=()=>{if(p!=="entry")return;const e=E("left"),t=E("right"),n=e.every(Boolean),l=t.every(Boolean);if(n&&!l){const r=A(e);r&&(oe("left",r),Y("left",r),k("Now complete the opposite side."))}else if(l&&!n){const r=A(t);r&&(oe("right",r),Y("right",r),k("Now complete the opposite side."))}};function Y(e,t){const n=document.getElementById("label-left"),l=document.getElementById("label-right"),r=(c,h)=>{c&&(c.textContent=h?h.toUpperCase():"",c.className=h==="truth"?"truth-label":h==="lie"?"lie-label":"")};e==="left"?(r(n,t),l&&r(l,"")):(r(l,t),n&&r(n,"")),i()}const re=()=>{if(p!=="entry")return;let e=!0;for(;e;)e=!1,["left","right"].forEach(t=>{G(t).forEach((n,l)=>{if(!n||n.dataset.symbol)return;const r=W(t,l);r.length===1&&(V(n,r[0]),e=!0,K())})});H()},ce=window.MAP_COORDS||{},de=window.SYMBOL_NAME_MAP||{};window.showMapHighlights=(e,t,n=!0)=>{const l=document.getElementById("map-overlay");if(!l)return;l.innerHTML="",[...e.map(c=>({sym:c,type:"truth"})),...t.map(c=>({sym:c,type:"lie"}))].forEach(({sym:c,type:h})=>{const w=ce[c];if(!w)return;const d=document.createElement("div");d.className=`symbol-wrap ${h}`,d.style.left=`${w.x}%`,d.style.top=`${w.y}%`,d.style.transform="translate(-50%, -50%)";const y=document.createElement("img");y.className="symbol-overlay",y.src=`img/${c}.png`,y.alt=c,d.appendChild(y);const L=w.y>=88;d.classList.add(L?"label-above":"label-below");const S=document.createElement("div");S.className="map-label",S.textContent=n?de[c]||c.toUpperCase():"",d.appendChild(S),l.appendChild(d)}),M(f.checked)},[...s].forEach(e=>{e.addEventListener("click",()=>{if(p==="final")return;const t=Array.from(e.classList),n=t.find(d=>/^left[123]$/.test(d)),l=t.find(d=>/^right[123]$/.test(d)),r=n?"left":l?"right":null,c=n?+n.replace("left","")-1:l?+l.replace("right","")-1:null;if(!r||c==null)return;if(p==="illumination"){v.includes(e)&&e.classList.toggle("glow");return}const h=!!e.dataset.symbol;let w=h?ae(r,c):W(r,c);if(h&&w.length===0&&e.dataset.symbol&&(w=[e.dataset.symbol]),m.innerHTML="",h){const d=document.createElement("div");d.textContent="Clear",Object.assign(d.style,{width:"60px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",background:"#333",border:"1px solid #777",borderRadius:"8px",color:"#fff",cursor:"pointer",fontSize:"14px",fontWeight:"700"}),d.addEventListener("click",()=>{V(e,""),a.style.display="none",ne(),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",k("Enter the symbols you see in-game"),i(),H()}),m.appendChild(d)}if(w.length===0){const d=document.createElement("div");d.textContent="No valid symbols",m.appendChild(d)}else w.forEach(d=>{const y=document.createElement("img");y.src=`img/${d}.png`,y.alt=d,y.addEventListener("click",()=>{V(e,d),a.style.display="none",K(),H(),re()}),m.appendChild(y)});a.style.display="block"})}),document.addEventListener("click",e=>{!a.contains(e.target)&&![...s].includes(e.target)&&(a.style.display="none")});const x=document.createElement("div");x.id="rotatePrompt",x.className="rotate-prompt",x.textContent="Rotate device to view map",document.body.appendChild(x);function T(e){x.classList.toggle("show",!!e)}function B(){const e=document.querySelector(".map-container"),t=document.querySelector(".map-img"),n=document.getElementById("map-overlay");if(!e||!t||!n)return;const l=window.visualViewport,r=l?l.width:window.innerWidth,c=l?l.height:window.innerHeight,h=l?l.offsetLeft:0,w=l?l.offsetTop:0,d=t.naturalWidth&&t.naturalHeight?t.naturalWidth/t.naturalHeight:1920/1080;let y=r,L=y/d;L>c&&(L=c,y=L*d);const S=h+(r-y)/2,X=w+(c-L)/2;Object.assign(t.style,{width:`${y}px`,height:`${L}px`,left:`${S}px`,top:`${X}px`}),Object.assign(n.style,{width:`${y}px`,height:`${L}px`,left:`${S}px`,top:`${X}px`})}async function me(){try{document.documentElement.requestFullscreen&&!document.fullscreenElement&&await document.documentElement.requestFullscreen(),screen.orientation&&screen.orientation.lock&&await screen.orientation.lock("landscape")}catch{}}async function ue(){if(!(window.innerWidth<=900))return;document.body.classList.add("map-only");const t=document.querySelector(".map-img");t?t.complete?B():t.addEventListener("load",B,{once:!0}):B(),await me(),T(window.matchMedia("(orientation: portrait)").matches)}function pe(){document.body.classList.remove("map-only"),T(!1),document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen().catch(()=>{})}const N=()=>{document.body.classList.contains("map-only")&&B()};if(window.addEventListener("resize",N),window.addEventListener("orientationchange",()=>{N(),document.body.classList.contains("map-only")&&T(window.matchMedia("(orientation: portrait)").matches)}),window.visualViewport){const e=window.visualViewport;e.addEventListener("resize",N),e.addEventListener("scroll",N)}function he(e,t){p="illumination",o.classList.add("glow-phase"),a.style.display="none",k("Now select the symbols that are illuminated in-game");const n=document.getElementById("label-left"),l=document.getElementById("label-right");n&&l&&(n.textContent=e.toUpperCase(),l.textContent=t.toUpperCase(),n.className=e==="truth"?"truth-label":"lie-label",l.className=t==="truth"?"truth-label":"lie-label",i());const r=E("left"),c=E("right");C=e==="truth"?r:c,I=e==="truth"?c:r,v=[],[...C,...I].forEach(h=>{const w=[...s].find(d=>d.dataset.symbol===h);w&&v.push(w)})}function J(){if(p!=="illumination")return;const e=[...document.querySelectorAll(".dial-slot.glow")].map(l=>l.dataset.symbol),t=C.filter(l=>e.includes(l)),n=I.filter(l=>!e.includes(l));o.classList.remove("glow-phase"),p="final",k("Follow the map to interact with the marked symbols. Tap Reset to start again."),window.showMapHighlights(t,n),ue()}function Q(){document.querySelectorAll(".dial-slot").forEach(t=>{t.dataset.symbol="",t.style.backgroundImage="",t.classList.remove("glow");const n=t.querySelector(".symbol-name");n&&(n.textContent="")}),document.getElementById("label-left").textContent="",document.getElementById("label-right").textContent="",o.classList.remove("glow-phase"),a.style.display="none",p="entry",v=[],C=[],I=[],ne(),k("Enter the symbols you see in-game");const e=document.getElementById("map-overlay");e&&(e.innerHTML=""),M(f.checked),pe(),i()}window.handleLock=J,window.resetDial=Q,o.addEventListener("click",J),u.addEventListener("click",Q);function H(){if(!ie())return;const e=E("left"),t=E("right"),n=A(e),l=A(t);!e.some(h=>t.includes(h))&&(n==="truth"&&l==="lie"||n==="lie"&&l==="truth")?he(n,l):k("Both sides must be opposite types with no duplicate symbols across the dial.")}});
